- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-18 04:58:50'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: 'Magmasystems Blog: The SQLDependency Object and Entitlements'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[http://magmasystems.blogspot.com/2008/09/sqldependency-object-and-entitlements.html#0001-01-01](http://magmasystems.blogspot.com/2008/09/sqldependency-object-and-entitlements.html#0001-01-01)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Our
  prefs: []
  type: TYPE_NORMAL
- en: CEP
  prefs: []
  type: TYPE_NORMAL
- en: Servers have to run 24x6\. When our server starts up, it reads some tables in
    our
  prefs: []
  type: TYPE_NORMAL
- en: SQL
  prefs: []
  type: TYPE_NORMAL
- en: Server 2005 database that contains information about users and the alerts that
    they are entitled to see. We don't want most of our users to be able to see alerts
    that occur because of order messages, but we do want our users to see alerts that
    occur from execution reports.
  prefs: []
  type: TYPE_NORMAL
- en: If we had to query the database for the entitlements on every single alert that
    flows through our system, we would take a tremendous hit in performance. Therefore,
    we cache the entitlements in memory and cache the result sets.
  prefs: []
  type: TYPE_NORMAL
- en: We want to be able to change our entitlements on-the-fly, while the server is
    running. We want to add and delete users, change the method of notification for
    a user (
  prefs: []
  type: TYPE_NORMAL
- en: Tibco
  prefs: []
  type: TYPE_NORMAL
- en: ','
  prefs: []
  type: TYPE_NORMAL
- en: SMS
  prefs: []
  type: TYPE_NORMAL
- en: ', email, messenger, etc), and add new alerts to our system. We could restrict
    all changes to the underlying entitlements tables so that the changes would have
    to made made through an Administrative GUI, but because of the environment inside
    our company, we cannot. Someone might add a user through the Admin GUI, and others
    might decide to go right into our'
  prefs: []
  type: TYPE_NORMAL
- en: SQL
  prefs: []
  type: TYPE_NORMAL
- en: Server database and add some new rows to our tables.
  prefs: []
  type: TYPE_NORMAL
- en: We need a way to detect when the
  prefs: []
  type: TYPE_NORMAL
- en: entitlement
  prefs: []
  type: TYPE_NORMAL
- en: tables have changed within our
  prefs: []
  type: TYPE_NORMAL
- en: SQL
  prefs: []
  type: TYPE_NORMAL
- en: Server database while our server in running, and have those changes reflected
    in the operation of our system. We cannot afford to bring our system down, make
    the changes to the entitlements, and restart our system. We also don't want to
    wait until the end of the week for the "green zone" period, where we can safely
    bring down our system, make the changes, and restart the system.
  prefs: []
  type: TYPE_NORMAL
- en: SQL
  prefs: []
  type: TYPE_NORMAL
- en: Server 2005 has a class called
  prefs: []
  type: TYPE_NORMAL
- en: SqlDependency
  prefs: []
  type: TYPE_NORMAL
- en: . This class can be used as an interface between
  prefs: []
  type: TYPE_NORMAL
- en: SQL
  prefs: []
  type: TYPE_NORMAL
- en: Service Broker and a .NET application to inform the .NET application when a
    certain query's result set has changed.
  prefs: []
  type: TYPE_NORMAL
- en: Most of the literature on the
  prefs: []
  type: TYPE_NORMAL
- en: SqlDependency
  prefs: []
  type: TYPE_NORMAL
- en: class revolves around using it in an ASP.NET application. There are also a bunch
    of things that you need to be aware of, such as restrictions on the syntax of
    the query that you give to the
  prefs: []
  type: TYPE_NORMAL
- en: SqlDependency
  prefs: []
  type: TYPE_NORMAL
- en: class. It took a little bit of digging and experimentation for me to get this
    stuff to work, but after a little while, we found that it did the job nicely.
  prefs: []
  type: TYPE_NORMAL
- en: I have enclosed the source code to a simple
  prefs: []
  type: TYPE_NORMAL
- en: EntitlementTableWatcher
  prefs: []
  type: TYPE_NORMAL
- en: class that shows you how to use
  prefs: []
  type: TYPE_NORMAL
- en: SqlDependency
  prefs: []
  type: TYPE_NORMAL
- en: . I have also include some links to URLs that I found useful. If you have any
    comments about the code, or if you find any bugs, please let me know and I will
    correct them.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: ©2008 Marc Adler - All Rights Reserved.
  prefs: []
  type: TYPE_NORMAL
- en: All opinions here are personal, and have no relation to my employer.
  prefs: []
  type: TYPE_NORMAL
