["```\n#explore how SP500 behaves in different ranges of Financial Conditions   \n```", "```\nrequire(quantmod)\nrequire(PerformanceAnalytics)\nrequire(ggplot2)   #get data from St. Louis Federal Reserve (FRED)\ngetSymbols(\"SP500\",src=\"FRED\") #load SP500\ngetSymbols(\"ANFCI\",src=\"FRED\") #load Adjusted Chicago Financial   \n```", "```\n#show a chart of ANFCI\nchartSeries(ANFCI,theme=\"white\",name=\"Adjusted National Financial Conditions (ANFCI)\")\n```", "```\n#do a little manipulation to get the data lined up on weekly basis\nSP500  <-  to.weekly(SP500)[,4]\nANFCI <- to.weekly(ANFCI)[,4]\n#get weekly format to yyyy-mm-dd with the first day of the week\nindex(SP500) <- as.Date(index(SP500))\nindex(ANFCI) <- as.Date(index(ANFCI))   \n```", "```\n#use floor to get ranges for ANFCI so we can run boxplots\nANFCI <- floor(ANFCI)\n#lag ANFCI signal\nANFCI <- lag(ANFCI,k=1)   #merge sp500 returns and ANFCI\nSP500_ANFCI <- na.omit(merge(ROC(SP500,n=1,type=\"discrete\"),ANFCI))\ncolnames(SP500_ANFCI) <- c(\"SP500\",\"ANFCI\")   \n```", "```\n#convert xts to data frame for ggplot boxplot exploration\ndf <- as.data.frame(cbind(index(SP500_ANFCI),\n\tcoredata(SP500_ANFCI[,1:2])))\nggplot(df,aes(factor(ANFCI),SP500)) +\n\tgeom_boxplot(aes(colour = factor(ANFCI))) +\n\topts(title=\"Box Plot of SP500 Weekly Change by Adjusted Financial Conditions\")       \n```", "```\n#show linked returns based on Adjusted Financial Conditions\nret_eq_neg3 <- ifelse(SP500_ANFCI[,2] == -3, SP500_ANFCI[,1], 0)\nret_eq_neg2 <- ifelse(SP500_ANFCI[,2] == -2, SP500_ANFCI[,1], 0)\nret_eq_neg1 <- ifelse(SP500_ANFCI[,2] == -1, SP500_ANFCI[,1], 0)\nret_eq_0 <- ifelse(SP500_ANFCI[,2] == 0, SP500_ANFCI[,1], 0)\nret_eq_pos1 <- ifelse(SP500_ANFCI[,2] == 1, SP500_ANFCI[,1], 0)\nret_eq_pos2 <- ifelse(SP500_ANFCI[,2] == 2, SP500_ANFCI[,1], 0)\nret_eq_pos3 <- ifelse(SP500_ANFCI[,2] == 3, SP500_ANFCI[,1], 0)\nret_eq_pos4 <- ifelse(SP500_ANFCI[,2] == 4, SP500_ANFCI[,1], 0)\nret_eq_pos5 <- ifelse(SP500_ANFCI[,2] == 5, SP500_ANFCI[,1], 0)   \n```", "```\n#merge series for PerformanceSummary chart\nret_comp <- merge(ret_eq_neg3, ret_eq_neg2, ret_eq_neg1, ret_eq_0,\n\tret_eq_pos1,ret_eq_pos2,ret_eq_pos3,ret_eq_pos4,ret_eq_pos5)\n#name columns for the legend\ncolnames(ret_comp) <- c(\"ANFCI=-3\",\"ANFCI=-2\",\"ANFCI=-1\",\"ANFCI=0\",\n\t\"ANFCI=1\",\"ANFCI=2\",\"ANFCI=3\",\"ANFCI=4\",\"ANFCI=5\")   \n```", "```\ncharts.PerformanceSummary(ret_comp, main=\"SP500 Linked Returns by Financial Conditions\")       \n```", "```\n#and just for fun a very basic system\nsignal <- runMax(SP500_ANFCI[,2] , n=10)\n#go long if Max of ANFCI over last ten weeks is 0; already lagged earlier\nret <- ifelse(signal <= 0, 1, 0) * SP500_ANFCI[,1]\nret <- merge(ret, SP500_ANFCI[,1])\ncolnames(ret) <- c(\"ANFCI_LongOnlySystem\",\"SP500\")\ncharts.PerformanceSummary(ret, ylog=TRUE, main=\"Very Simple ANFCI S&P 500 System\",\n\tcolorset=c(\"cadetblue\",\"darkolivegreen3\"))\n```"]