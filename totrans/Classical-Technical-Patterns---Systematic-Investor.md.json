["```\n\n###############################################################################\n# Load Systematic Investor Toolbox (SIT)\n###############################################################################\ncon = gzcon(url('http://www.systematicportfolio.com/sit.gz', 'rb'))\n    source(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\n\tticker = 'SPY'\n\n\tdata = getSymbols(ticker, src = 'yahoo', from = '1970-01-01', auto.assign = F)\n\t\tdata = adjustOHLC(data, use.Adjusted=T)\n\n\t#*****************************************************************\n\t# Find Classical Techical Patterns, based on\n\t# Pattern Matching. Based on Foundations of Technical Analysis\n\t# by A.W. LO, H. MAMAYSKY, J. WANG\t\n\t#****************************************************************** \n\tplot.patterns(data, 190, ticker)\n\n```", "```\n\n\tlibrary(sm)\n\ty = as.vector( last( Cl(data), 190) )\n\tt = 1:len(y)\n\n\t# fit kernel regression with cross-validatio\n\th = h.select(t, y, method = 'cv')\n\t\ttemp = sm.regression(t, y, h=h, display = 'none')\n\n\t# find estimated fit\n\tmhat = approx(temp$eval.points, temp$estimate, t, method='linear')$y\n\n```", "```\n\n\ttemp = diff(sign(diff(mhat)))\n\t# loc - location of extrema, loc.dir - direction of extrema\n\tloc = which( temp != 0 ) + 1\n\t\tloc.dir = -sign(temp[(loc - 1)])\n\n```", "```\n\n\t#****************************************************************** \t\n\t# Head-and-shoulders (HS)\n\t#****************************************************************** \t\n\tpattern = list()\n\tpattern$len = 5\n\tpattern$start = 'max'\n\tpattern$formula = expression({\n\t\tavg.top = (E1 + E5) / 2\n\t\tavg.bot = (E2 + E4) / 2\n\n\t\t# E3 > E1, E3 > E5\n\t\tE3 > E1 &\n\t\tE3 > E5 &\n\n\t\t# E1 and E5 are within 1.5 percent of their average\n\t\tabs(E1 - avg.top) < 1.5/100 * avg.top &\n\t\tabs(E5 - avg.top) < 1.5/100 * avg.top &\n\n\t\t# E2 and E4 are within 1.5 percent of their average\n\t\tabs(E2 - avg.bot) < 1.5/100 * avg.bot &\n\t\tabs(E4 - avg.bot) < 1.5/100 * avg.bot\n\t\t})\n\tpatterns$HS = pattern\t\t\n\n```", "```\n\nfind.patterns <- function\n(\n\tobj, \t# extrema points\n\tpatterns = pattern.db() \n) \n{\n\tdata = obj$data\n\textrema.dir = obj$extrema.dir\n\tdata.extrema.loc = obj$data.extrema.loc\n\tn.index = len(data.extrema.loc)\n\n\t# search for patterns\n\tfor(i in 1:n.index) {\n\n\t\tfor(pattern in patterns) {\n\n\t\t\t# check same sign\n\t\t\tif( pattern$start * extrema.dir[i] > 0 ) {\n\n\t\t\t\t# check that there is suffcient number of extrema to complete pattern\n\t\t\t\tif( i + pattern$len - 1 <= n.index ) {\n\n\t\t\t\t\t# create enviroment to check pattern: E1,E2,...,En; t1,t2,...,tn\n\t\t\t\t\tenvir.data = c(data[data.extrema.loc][i:(i + pattern$len - 1)], \n\t\t\t\t\tdata.extrema.loc[i:(i + pattern$len - 1)])\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tnames(envir.data) = c(paste('E', 1:pattern$len, sep=''), \n\t\t\t\t\t\t\tpaste('t', 1:pattern$len, sep=''))\n\t\t\t\t\tenvir.data = as.list(envir.data)\t\t\t\t\t\n\n\t\t\t\t\t# check if pattern was found\n\t\t\t\t\tif( eval(pattern$formula, envir = envir.data) ) {\n\t\t\t\t\t\tcat('Found', pattern$name, 'at', i, '\\n')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\n\t\t}\t\n\t}\n\n}\n\n```", "```\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\n\tticker = 'SPY'\n\n\tdata = getSymbols(ticker, src = 'yahoo', from = '1970-01-01', auto.assign = F)\n\t\tdata = adjustOHLC(data, use.Adjusted=T)\n\n\t#*****************************************************************\n\t# Find Classical Techical Patterns, based on\n\t# Pattern Matching. Based on Foundations of Technical Analysis\n\t# by A.W. LO, H. MAMAYSKY, J. WANG\t\n\t#****************************************************************** \n\tplot.patterns(data, 150, ticker)\n\n```"]