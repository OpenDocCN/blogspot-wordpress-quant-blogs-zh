["```\n\n\tshare = weight * capital / price\n\tcash  = capital - share * price\n\n```", "```\n\n\tshare = 10 shares\n\tcash = $0\n\n```", "```\n\n\treturn = [share * price + cash] / [share * price.yesterday + cash] - 1\n\n```", "```\n\n\ttotal.return = [1 + return.0] * [1 + return.1] * ... * [1 + return.n] - 1\n\n```", "```\n\n\tportfolio.return = rowSums((share * price + cash) / (share * mlag(price) + cash) - 1)\n\n```", "```\n\n\tequity = cumprod(1 + portfolio.return)\n\n```", "```\n\n\t[P0 - com] / P0 is close (equal) to P0 / [P0 + com] and\n\t[P0 - com] * P1 is close (equal) to P0 * [P1 - com]\n\n```", "```\n\n\treturn = [share * price + cash - commission] / [share * price.yesterday + cash] - 1\n\n```", "```\n\n\tLet's say we are fully invested (i.e. cash = 0 and capital = share * P0)\n\n\topening trade cost = share * P0 + com\n\tclosing  trade cost = share * P1 - com\n\n\treturn = [closing  trade cost] / [opening trade cost] - 1\n\t= [share * P1 - com] / [share * P0 + com] - 1\n\n```", "```\n\n\t([capital - com] / [capital]) * ([share * P1 + cash - com] / [share * P0 + cash]) - 1\n\n\t< given that cash = 0 and capital = share * P0 >\n\t= ([share * P0 - com] / [share * P0]) * ([share * P1 - com] / [share * P0]) - 1\n\n\t< given [P0 - com] / P0 ~ P0 / [P0 + com] >\n\t= ([share * P0] / [share * P0 + com] / ) * ([share * P1 - com] / [share * P0]) - 1\n\n\t= [share * P1 - com] / [share * P0 + com] - 1\n\n```", "```\n\n    \tcommission = abs(share - mlag(share)) * commission$cps\n\n    ```", "```\n\n    \tcommission = sign(abs(share - mlag(share))) * commission$fixed\n\n    ```", "```\n\n    \tcommission = price * abs(share - mlag(share)) * commission$percentage\n\n    ```", "```\n\n\tthe total.commission = cps.commission + fixed.commission + percentage.commission\n\n```", "```\n\n\treturn = (share * price + cash - total.commission) / (share * mlag(price) + cash) - 1\n\n```", "```\n    commission = 0.1\n    ```", "```\n    commission = list(cps = 0.1, fixed = 0.0, percentage = 0.0)\n    ```", "```\n    commission = list(cps = 0.0, fixed = 0.0, percentage = 0.0)\n    ```", "```\n\n###############################################################################\n# Load Systematic Investor Toolbox (SIT)\n# https://systematicinvestor.wordpress.com/systematic-investor-toolbox/\n###############################################################################\nsetInternet2(TRUE)\ncon = gzcon(url('http://www.systematicportfolio.com/sit.gz', 'rb'))\n    source(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\t\n\ttickers = spl('EEM')\n\n\tdata <- new.env()\n\tgetSymbols(tickers, src = 'yahoo', from = '1970-01-01', env = data, auto.assign = T)\n\t\tfor(i in ls(data)) data[[i]] = adjustOHLC(data[[i]], use.Adjusted=T)\t\t\t\n\tbt.prep(data, align='keep.all', dates='2013:08::2013:09')\t\n\n\t#*****************************************************************\n\t# Code Strategies\n\t#****************************************************************** \t\t\n\tbuy.date = '2013:08:14'\t\n\tsell.date = '2013:08:15'\n\tday.after.sell.date = '2013:08:16'\t\t\n\n\tcapital = 100000\n\tprices = data$prices\n\tshare = as.double(capital / prices[buy.date])\n\n\t# helper function to compute trade return\n\tcomp.ret <- function(sell.trade.cost, buy.trade.cost) { round(100 * (as.double(sell.trade.cost) / as.double(buy.trade.cost) - 1), 2) }\n\n\t#*****************************************************************\n\t# Zero commission\n\t#****************************************************************** \n\tdata$weight[] = NA\n\t\tdata$weight[buy.date] = 1\n\t\tdata$weight[sell.date] = 0\n\t\tcommission = 0.0\n\tmodel = bt.run.share(data, commission = commission, capital = capital, silent = T)\n\n\tcomp.ret( share * prices[sell.date], share * prices[buy.date] )\t\t\n\tcomp.ret( model$equity[day.after.sell.date], model$equity[buy.date] )\t\t\n\n\t#*****************************************************************\n\t# 10c cps commission\n\t# cents / share commission\n   \t#   trade cost = abs(share - mlag(share)) * commission$cps\t\n\t#****************************************************************** \n\tdata$weight[] = NA\n\t\tdata$weight[buy.date] = 1\n\t\tdata$weight[sell.date] = 0\n\t\tcommission = 0.1\n\tmodel = bt.run.share(data, commission = commission, capital = capital, silent = T)\n\n\tcomp.ret( share * (prices[sell.date] - commission), share * (prices[buy.date] + commission) )\n\tcomp.ret( model$equity[day.after.sell.date], model$equity[buy.date] )\t\t\n\n\t#*****************************************************************\n\t# $5 fixed commission\n\t# fixed commission per trade to more effectively to penalize for turnover\n   \t#   trade cost = sign(abs(share - mlag(share))) * commission$fixed\t\n\t#****************************************************************** \n\tdata$weight[] = NA\n\t\tdata$weight[buy.date] = 1\n\t\tdata$weight[sell.date] = 0\n\t\tcommission = list(cps = 0.0, fixed = 5.0, percentage = 0.0)\t\n\tmodel = bt.run.share(data, commission = commission, capital = capital, silent = T)\n\n\tcomp.ret( share * prices[sell.date] - commission$fixed, share * prices[buy.date] + commission$fixed )\n\tcomp.ret( model$equity[day.after.sell.date], model$equity[buy.date] )\t\t\n\n\t#*****************************************************************\n\t# % commission\n\t# percentage commission\n\t#   trade cost = price * abs(share - mlag(share)) * commission$percentage\t\n\t#****************************************************************** \n\tdata$weight[] = NA\n\t\tdata$weight[buy.date] = 1\n\t\tdata$weight[sell.date] = 0\n\t\tcommission = list(cps = 0.0, fixed = 0.0, percentage = 1/100)\t\n\tmodel = bt.run.share(data, commission = commission, capital = capital, silent = T)\n\n\tcomp.ret( share * prices[sell.date] * (1 - commission$percentage), share * prices[buy.date] * (1 + commission$percentage) )\n\tcomp.ret( model$equity[day.after.sell.date], model$equity[buy.date] )\t\n\n```"]