["```\nrequire(PerformanceAnalytics)\nrequire(quantmod)   #set this up to get either FRED or Yahoo!Finance\n#getSymbols(\"GSPC\",src=\"FRED\")\ngetSymbols(\"^GSPC\",from=\"1896-01-01\",to=Sys.Date())     GSPC <- to.weekly(GSPC)[,4]\n#GSPCmean <- runMean(GSPC,n=20)\n#index(GSPC) <- as.Date(index(GSPC))   width = 25\nfor (i in (width+1):NROW(GSPC)) {\n\tlinmod <- lm(GSPC[((i-width):i),1]~index(GSPC[((i-width):i)]))\n\tifelse(i==width+1,signal <- coredata(linmod$residuals[length(linmod$residuals)]),\n\t\tsignal <- rbind(signal,coredata(linmod$residuals[length(linmod$residuals)])))\n\tifelse(i==width+1,signal2 <- coredata(linmod$coefficients[2]),\n\t\tsignal2 <- rbind(signal2,coredata(linmod$coefficients[2])))\n\tifelse(i==width+1,signal3 <- cor(linmod$fitted.values,GSPC[((i-width):i),1]),\n\t\tsignal3 <- rbind(signal3,cor(linmod$fitted.values,GSPC[((i-width):i),1])))\n}\nsignal <- as.xts(signal,order.by=index(GSPC[(width+1):NROW(GSPC)]))\nsignal2 <- as.xts(signal2,order.by=index(GSPC[(width+1):NROW(GSPC)]))\nsignal3 <- as.xts(signal3,order.by=index(GSPC[(width+1):NROW(GSPC)]))   price_ret_signal <- merge(GSPC,lag(signal,k=1),\n\tlag(signal2,k=1),lag(signal3,k=1),\n\tROC(GSPC,type=\"discrete\",n=1))\nprice_ret_signal[,2] <- price_ret_signal[,2]/price_ret_signal[,1]\nprice_ret_signal[,3] <- price_ret_signal[,3]/price_ret_signal[,1]   #ret <- ifelse((runMin(price_ret_signal[,3],n=10) >= 0  &\n#\trunSum(price_ret_signal[,2],n=30) >= 0.0) | \n#\t(runMin(price_ret_signal[,3],30) < 0 & \n#\trunSum(price_ret_signal[,2],n=50) >= 0.02),\n#\t 1, 0) * price_ret_signal[,5]\n#ret <- ifelse(runSum(price_ret_signal[,3],n=10) >= 0, 1, 0) * price_ret_signal[,5]   ret <- ifelse((runMean(price_ret_signal[,3],n=5) > 0 & \n\trunMean(price_ret_signal[,4],n=5) > 0.25),\n\t1, 0) * price_ret_signal[,5]   retCompare <- merge(ret, price_ret_signal[,5])\ncolnames(retCompare) <- c(\"Linear System\", \"BuyHold\")\ncharts.PerformanceSummary(retCompare,ylog=TRUE,cex.legend=1.2,\n\tcolorset=c(\"black\",\"gray70\"),main=\"GSPC System Return Comparison\")\n```"]