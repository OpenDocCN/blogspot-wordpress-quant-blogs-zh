["```\n\n# Load Systematic Investor Toolbox (SIT)\nsetInternet2(TRUE)\ncon = gzcon(url('https://github.com/systematicinvestor/SIT/raw/master/sit.gz', 'rb'))\n\tsource(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\t\n\ttickers = spl('XLY,XLP,XLE,XLF,XLV,XLI,XLB,XLK,XLU,IWB,IWD,IWF,IWM,IWN,IWO,IWP,IWR,IWS,IWV,IWW,IWZ')\n\n\tdata <- new.env()\n\tgetSymbols(tickers, src = 'yahoo', from = '1970-01-01', env = data, auto.assign = T)\n\t\tfor(i in ls(data)) data[[i]] = adjustOHLC(data[[i]], use.Adjusted=T)\t\t\n\tbt.prep(data, align='remove.na', dates='1970::2011')\n\n\t#*****************************************************************\n\t# Code Strategies : weekly rebalancing\n\t#****************************************************************** \n\tprices = data$prices  \n\tn = len(tickers)  \n\n\t# find week ends\n\tweek.ends = endpoints(prices, 'weeks')\n\t\tweek.ends = week.ends[week.ends > 0]\t\t\n\n\t# Rank on ROC 200\n\tposition.score = prices / mlag(prices, 200)\t\n\t\tposition.score.ma = position.score\t\t\n\t\tbuy.rule = T\n\n\t# Select Top 2 funds daily\n\tdata$weight[] = NA\n\t\tdata$weight[] = ntop(position.score, 2)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\t\t\n\ttop2.d = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\t# Select Top 2 funds weekly\n\tdata$weight[] = NA\n\t\tdata$weight[week.ends,] = ntop(position.score[week.ends,], 2)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\ttop2.w = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\t# Plot Strategy Metrics Side by Side\n\tplotbt.strategy.sidebyside(top2.d, top2.w, perfromance.fn = 'engineering.returns.kpi')\t\n\n```", "```\n\n\t#*****************************************************************\n\t# Code Strategies : different entry/exit rank\n\t#****************************************************************** \n\n\t# Select Top 2 funds, Keep till they are in 4/6 rank\n\tdata$weight[] = NA\n\t\tdata$weight[] = ntop.keep(position.score, 2, 4)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\ttop2.d.keep4 = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\tdata$weight[] = NA\n\t\tdata$weight[] = ntop.keep(position.score, 2, 6)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\ttop2.d.keep6 = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\t# Plot Strategy Metrics Side by Side\n\tplotbt.strategy.sidebyside(top2.d, top2.d.keep4, top2.d.keep6, perfromance.fn = 'engineering.returns.kpi')\n\n```", "```\n\n\t#*****************************************************************\n\t# Code Strategies : Rank smoothing\n\t#****************************************************************** \n\n\tmodels = list()\n\tmodels$Bench = top2.d\n\tfor( avg in spl('SMA,EMA') ) {\n\t\tfor( i in c(3,5,10,20) ) {\t\t\n\t\t\tposition.score.smooth = bt.apply.matrix(position.score.ma, avg, i)\t\n\t\t\t\tposition.score.smooth[!buy.rule,] = NA\n\n\t\t\tdata$weight[] = NA\n\t\t\t\tdata$weight[] = ntop(position.score.smooth, 2)\t\n\t\t\t\tcapital = 100000\n\t\t\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\t\t\tmodels[[ paste(avg,i) ]] = bt.run(data, type='share', trade.summary=T, capital=capital)\t\t\n\t\t}\n\t}\n\n\t# Plot Strategy Metrics Side by Side\n\tplotbt.strategy.sidebyside(models, perfromance.fn = 'engineering.returns.kpi')\n\n```", "```\n\n\t#*****************************************************************\n\t# Code Strategies : Combination\n\t#****************************************************************** \n\n\t# Select Top 2 funds daily, Keep till they are 6 rank, Smooth Rank by 10 day EMA\n\tposition.score.smooth = bt.apply.matrix(position.score.ma, 'EMA', 10)\t\n\t\tposition.score.smooth[!buy.rule,] = NA\n\tdata$weight[] = NA\n\t\tdata$weight[] = ntop.keep(position.score.smooth, 2, 6)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\ttop2.d.keep6.EMA10 = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\t# Select Top 2 funds weekly, Keep till they are 6 rank\n\tdata$weight[] = NA\n\t\tdata$weight[week.ends,] = ntop.keep(position.score[week.ends,], 2, 6)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\ttop2.w.keep6 = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\t# Select Top 2 funds weekly, Keep till they are 6 rank, Smooth Rank by 10 week EMA\n\tposition.score.smooth[] = NA\n\t\tposition.score.smooth[week.ends,] = bt.apply.matrix(position.score.ma[week.ends,], 'EMA', 10)\t\n\t\t\tposition.score.smooth[!buy.rule,] = NA\n\n\tdata$weight[] = NA\n\t\tdata$weight[week.ends,] = ntop.keep(position.score.smooth[week.ends,], 2, 6)\t\n\t\tcapital = 100000\n\t\tdata$weight[] = (capital / prices) * bt.exrem(data$weight)\t\t\n\ttop2.w.keep6.EMA10 = bt.run(data, type='share', trade.summary=T, capital=capital)\n\n\t# Plot Strategy Metrics Side by Side\n\tplotbt.strategy.sidebyside(top2.d, top2.d.keep6, top2.d.keep6.EMA10, top2.w, top2.w.keep6, top2.w.keep6.EMA10, perfromance.fn = 'engineering.returns.kpi')\n\n```"]