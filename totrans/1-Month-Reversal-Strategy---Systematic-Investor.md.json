["```\n\n###############################################################################\n# Load Systematic Investor Toolbox (SIT)\n# https://systematicinvestor.wordpress.com/systematic-investor-toolbox/\n###############################################################################\nsetInternet2(TRUE)\ncon = gzcon(url('http://www.systematicportfolio.com/sit.gz', 'rb'))\n    source(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\t\n\ttickers = sp500.components()$tickers\n\n\tdata <- new.env()\n\tgetSymbols(tickers, src = 'yahoo', from = '1970-01-01', env = data, auto.assign = T)\n\t\t# remove companies with less than 5 years of data\n\t\trm.index = which( sapply(ls(data), function(x) nrow(data[[x]])) < 1000 )\t\n\t\trm(list=names(rm.index), envir=data)\n\n\t\tfor(i in ls(data)) data[[i]] = adjustOHLC(data[[i]], use.Adjusted=T)\t\t\n\tbt.prep(data, align='keep.all', dates='1994::')\n\t\ttickers = data$symbolnames\n\n\tdata.spy <- new.env()\n\tgetSymbols('SPY', src = 'yahoo', from = '1970-01-01', env = data.spy, auto.assign = T)\n\tbt.prep(data.spy, align='keep.all', dates='1994::')\n\n\t#*****************************************************************\n\t# Code Strategies\n\t#****************************************************************** \n\tprices = data$prices\n\t\tn = ncol(prices)\n\n\t#*****************************************************************\n\t# Setup monthly periods\n\t#****************************************************************** \n\tperiodicity = 'months'\n\n\tperiod.ends = endpoints(data$prices, periodicity)\n\t\tperiod.ends = period.ends[period.ends > 0]\n\n\tprices = prices[period.ends, ]\t\t\n\n\t#*****************************************************************\n\t# Create Benchmarks, omit results for the first 36 months - to be consistent with Factor Attribution\n\t#****************************************************************** \t\n\tmodels = list()\n\n\t# SPY\n\tdata.spy$weight[] = NA\n\t\tdata.spy$weight[] = 1\n\t\tdata.spy$weight[1:period.ends[36],] = NA\n\tmodels$spy = bt.run(data.spy)\n\n\t# Equal Weight\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = ntop(prices, n)\n\t\tdata$weight[1:period.ends[36],] = NA\t\t\n\tmodels$equal.weight = bt.run(data)\n\n```", "```\n\n\t#*****************************************************************\n\t# Create Reversal Quantiles\n\t#****************************************************************** \n\tn.quantiles = 5\n\tstart.t = 1 + 36\n\tquantiles = weights = coredata(prices) * NA\t\t\t\n\n\tone.month = coredata(prices / mlag(prices))\n\n\tfor( t in start.t:nrow(weights) ) {\n\t\tfactor = as.vector(one.month[t,])\n\t\tranking = ceiling(n.quantiles * rank(factor, na.last = 'keep','first') / count(factor))\n\n\t\tquantiles[t,] = ranking\n\t\tweights[t,] = 1/tapply(rep(1,n), ranking, sum)[ranking]\t\t\t\n\t}\n\n\tquantiles = ifna(quantiles,0)\n\n\t#*****************************************************************\n\t# Create backtest for each Quintile\n\t#****************************************************************** \n\ttemp = weights * NA\n\n\tfor( i in 1:n.quantiles) {\n\t\ttemp[] = 0\n\t\ttemp[quantiles == i] = weights[quantiles == i]\n\n\t\tdata$weight[] = NA\n\t\t\tdata$weight[period.ends,] = temp\n\t\tmodels[[ paste('M1_Q',i,sep='') ]] = bt.run(data, silent = T)\n\t}\n\n```", "```\n\n\t#*****************************************************************\n\t# Create Q1-Q5 spread\n\t#****************************************************************** \n\ttemp[] = 0\n\ttemp[quantiles == 1] = weights[quantiles == 1]\n\ttemp[quantiles == n.quantiles] = -weights[quantiles == n.quantiles]\n\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = temp\n\tmodels$spread = bt.run(data, silent = T)\t\n\n\t#*****************************************************************\n\t# Create Report\n\t#****************************************************************** \t\n\tplotbt.custom.report.part1(models)\n\n\tplotbt.custom.report.part1(models[spl('spy,equal.weight,spread')])\n\n```"]