- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-18 06:42:49'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: 'IEX Peg Orders: Last Look for Equity Markets? | Mechanical Markets'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://mechanicalmarkets.wordpress.com/2015/10/05/iex-peg-orders-last-look-for-equity-markets/#0001-01-01](https://mechanicalmarkets.wordpress.com/2015/10/05/iex-peg-orders-last-look-for-equity-markets/#0001-01-01)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Matt Levine recently [challenged](http://www.bloombergview.com/articles/2015-09-16/the-flash-boys-exchange-is-growing-up)
    his readers to describe how IEX’s speedbump might be gamed:'
  prefs: []
  type: TYPE_NORMAL
- en: It’s hard for ***me*** to figure out a way to game it. You all are smart, tell
    me how to game it. The prize is maybe you get to game it.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: I’ve [discussed](https://mechanicalmarkets.wordpress.com/2015/08/11/iex-ideology-and-the-role-of-an-exchange/)
    some issues with the IEX platform. In this post, I’ll add detail for a few of
    those issues. And, while labeling an exchange “gameable” is subjective, IEX peg
    orders remind me of controversies from other markets. I haven’t seen IEX’s source
    code or system design, so this post is speculative.
  prefs: []
  type: TYPE_NORMAL
- en: All orders sent to IEX go through the 350us “shoebox” delay, at the time of
    entry. However, the exchange does not apply the delay to algorithmic order types
    such as peg orders. This behavior is designed to prevent nefarious traders who,
    after seeing a quote change on another exchange, rapidly submit aggressive orders
    to IEX, hoping to hit an order pegged at the now-stale price. [[1](#bottom1iexpeg)]
    IEX’s intention is a good one. But, if the shoebox delay is not fine-tuned, there
    can be some undesirable side effects.
  prefs: []
  type: TYPE_NORMAL
- en: Last Look
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Orders on many spot FX exchanges are subject to what’s called “last look,” where
    the resting side, after a match, may briefly wait before deciding to proceed with
    the trade. Last look helps bank liquidity-providers avoid being “picked off,”
    and gives them option-value by letting them back out of fills if the market goes
    against them. It may serve legitimate business purposes, but it’s easy to understand
    why the practice is [controversial](http://www.bloomberg.com/news/articles/2015-03-03/barclays-last-look-at-currency-trades-said-to-face-u-s-review).
    BlackRock, for instance, has [said](http://www.bloomberg.com/news/articles/2015-02-24/eliminate-phantom-liquidity-in-currency-markets-blackrock-says)
    that last look causes “phantom liquidity.”
  prefs: []
  type: TYPE_NORMAL
- en: 'IEX peg orders offer something like a ‘conditional’ last look. Instead of becoming
    non-firm at the trader’s discretion, peg orders opt-out of executions only if
    the NBBO moves away within 350us of the incoming order’s reception. [[2](#bottom2iexpeg)]
    This restriction makes them less valuable than true last look, but their option-value
    is still very significant. How significant? I would estimate that it’s worth around
    half a tick. To give a rough idea, here is a plot of trades on Nasdaq, grouped
    by whether Nasdaq still had a quote present at the same price 350us later:'
  prefs: []
  type: TYPE_NORMAL
- en: '[![aug2X_inet_vsInetBbo350usPostFill_800](img/d0df82b0706e2510a9f90c108c40650c.png)](https://mechanicalmarkets.wordpress.com/wp-content/uploads/2015/10/aug2x_inet_vsinetbbo350uspostfill_800.png)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Top panel: Average market-priced profit or loss per share vs distance in time
    from trade, from the perspective of the passive side of the trade. Trades are
    grouped by how their price compared to the (round lot) Nasdaq BBO, 350us post-trade.
    Roughly speaking, if Nasdaq were to pull its orders in similar circumstances as
    IEX pulls its peg orders, Nasdaq would prevent all the trades from the “Better
    than 350us Post-Trade Nasdaq BBO” group. The group that would remain (“Equal or
    Worse Than 350us Post-Trade Nasdaq BBO”) would be very profitable after receiving
    the ~30mil rebate. Visible execution only. The “market price” is the average price
    of the most recently traded 100 shares. Chart is over 8 days in August 2014 and
    excludes fees and rebates. Bottom panel: Shares traded on Nasdaq vs time from
    trade (including fiducial trade).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the same for colocated trades on Nasdaq BX, again grouped by how they
    compared to the Nasdaq (Inet) BBO 350us post-trade:'
  prefs: []
  type: TYPE_NORMAL
- en: '[![aug2X_bsx_vsInetBbo350usPostFill_800](img/7913a87857b1a5ca508519bbd601b0bf.png)](https://mechanicalmarkets.wordpress.com/wp-content/uploads/2015/10/aug2x_bsx_vsinetbbo350uspostfill_800.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Other, non-colocated exchanges (like [BatsZ](https://mechanicalmarkets.wordpress.com/wp-content/uploads/2015/10/aug2x_batsz_vsinetbbo350uspostfill.png)
    or [EdgeX](https://mechanicalmarkets.wordpress.com/wp-content/uploads/2015/10/aug2x_edgex_vsinetbbo350uspostfill.png))
    that I checked are similar.
  prefs: []
  type: TYPE_NORMAL
- en: These charts are just hints at the option-value offered by IEX and are closest
    in spirit to IEX primary peg orders, which (I think) only trade at the 350us ex-post
    NBBO. [[3](#bottom3iexpeg)] The edge that midpoint pegs and D-Pegs receive from
    the head start is much harder to estimate, but I expect that it’s sizable.
  prefs: []
  type: TYPE_NORMAL
- en: It might seem like the edge I’ve described is solely due to IEX successfully
    preventing peg orders from being “picked off.” It isn’t. A peg order is “picked
    off” when its counterparty has reacted to an event which should have previously
    caused that order to be repriced. IEX is repricing peg orders using information
    that counterparties didn’t have at the time of their orders’ submission. Equities
    markets are decentralized, and partly unsynchronized — IEX claims to have fixed
    all race conditions, but they have only fixed one, and by doing so they’ve created
    others. [[4](#bottom4iexpeg)]
  prefs: []
  type: TYPE_NORMAL
- en: Sources of Peg Orders’ Edge
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Sophisticated traders might take advantage of the option-value offered by IEX
    by simply sending peg orders instead of normal, firm orders. If they’re fast enough
    to be the first peg orders received by IEX, the estimated 50mil edge could make
    losing strategies wildly profitable.
  prefs: []
  type: TYPE_NORMAL
- en: 'Where does this money come from? I think it’s mostly from two populations:'
  prefs: []
  type: TYPE_NORMAL
- en: '**1)** All resting orders on other exchanges:'
  prefs: []
  type: TYPE_NORMAL
- en: '**A)** IEX pegs are priced using other exchanges’ quotes. Peg orders that would
    have been unviable economically will now be profitable, through their use of information
    about the future state of those quotes.'
  prefs: []
  type: TYPE_NORMAL
- en: '**B)** These peg orders will proliferate on IEX.'
  prefs: []
  type: TYPE_NORMAL
- en: '**C)** Orders sent to IEX that would otherwise have been routed out to other
    exchanges will now trade with these proliferated peg orders.'
  prefs: []
  type: TYPE_NORMAL
- en: '**D)** That will lead to fewer, more toxic fills for passive orders on every
    other exchange.'
  prefs: []
  type: TYPE_NORMAL
- en: '**E)** Market makers may widen their quotes to compensate for this adverse
    selection.'
  prefs: []
  type: TYPE_NORMAL
- en: '**2)** High-alpha aggressive orders on IEX:'
  prefs: []
  type: TYPE_NORMAL
- en: '**A)** Aggressive traders may cause or predict the movement of prices on other
    exchanges.'
  prefs: []
  type: TYPE_NORMAL
- en: '**B)** IEX will see these price movements, which occur *after* they receive
    aggressive orders, and pull posted peg orders which would have executed. This
    [fading](https://mechanicalmarkets.wordpress.com/2015/08/11/iex-ideology-and-the-role-of-an-exchange/#2iex2)
    of liquidity could harm the same traders that Michael Lewis wanted to protect.'
  prefs: []
  type: TYPE_NORMAL
- en: '**C)** Aggressive traders could send their orders to IEX 350us before sending
    orders to other exchanges, in the spirit of Thor. That would prevent IEX from
    using future information to pull peg orders. Delaying orders is not always an
    option though; if the aggressive trader is an execution algorithm reacting to
    a trade, it couldn’t afford to delay any of its orders. If it did, a competing
    execution algorithm (or HFT) might clear out the available liquidity. Thor-style
    delays may work for human traders, but are not helpful for the vast majority of
    volume executed by computers.'
  prefs: []
  type: TYPE_NORMAL
- en: Unintended Usage
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Knowing exactly how these orders will behave, sophisticated traders can integrate
    them into their strategies more effectively than other users. I bet it’s profitable
    to simply copy quotes posted on other exchanges onto IEX with peg orders. IEX
    allows traders to mirror liquidity from other exchanges, without the risk of getting
    run-over that normally entails. And, most of this revenue will be earned by high-speed
    traders. When there’s a structural inefficiency like this one, the fastest orders
    capture the profit. A 50 mil per share edge is very enticing to HFTs, and I’d
    expect that many will soon be competing in a race to be first in the ‘peg order
    queue’ (if they aren’t already).
  prefs: []
  type: TYPE_NORMAL
- en: I’m sure there are many other examples where conditional executions allowed
    by the speedbump change the circumstances of trading from win/lose to win/scratch.
    [[5](#bottom5iexpeg)][[6](#bottom6iexpeg)]
  prefs: []
  type: TYPE_NORMAL
- en: Understanding Timescales of Trading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Put a certain way, IEX’s speedbump doesn’t sound very significant; 350us is
    less than 1% of the time it takes to blink. But, like it or not, computers do
    the majority of trading these days, including on behalf of fundamental traders.
    Market professionals know a lot can happen in hundreds of microseconds, and a
    speed advantage of that magnitude can guarantee profit. IEX knows this too. Cofounder
    Dan Aisen [says](http://blog.quantopian.com/the-genesis-of-an-order-type-by-daniel-aisen/)
    that “350 microseconds is an enormous head start.”
  prefs: []
  type: TYPE_NORMAL
- en: Selective application of a speedbump is economically equivalent to an exchange
    distributing a secret data feed, providing anointed traders advance notice about
    changes in the order book. A simple system update would resolve this issue. IEX
    could keep its peg orders from executing at stale prices, without using information
    their counterparties don’t yet have.
  prefs: []
  type: TYPE_NORMAL
- en: FX traders understand the consequences of interacting with last look liquidity,
    and can route their orders elsewhere. Equity markets are different. Maybe last
    look would tighten spreads for retail traders. But we should think hard before
    bringing it to our stock market.
  prefs: []
  type: TYPE_NORMAL
- en: '[[1](#1iexpeg)] A crude example of what IEX hopes to avoid:'
  prefs: []
  type: TYPE_NORMAL
- en: Nasdaq has set the NBBO of a stock, which is 10.00/10.01.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: IEX has a primary peg order on its bid, currently resting at 10.00.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Somebody sends a large sell order to Nasdaq, clearing out the bid and leaving
    some quantity resting at 10.00\. The new NBBO is 9.99/10.00.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: High-speed Trader A sees that and quickly sends an order to IEX to sell at 10.00.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If IEX were to receive Trader A’s sell order before they knew that the NBBO
    had changed, then they’d execute it against the peg order at 10.00\. That’d be
    bad for the peg order. So, IEX delays the high-speed trader’s order for 350us,
    which is more than enough time for them to see that the NBBO has changed and reprice
    the peg order to 9.99, preventing it from being “picked off.”
  prefs: []
  type: TYPE_NORMAL
- en: '[[2](#2iexpeg)] Mostly. D-Peg orders adjust their price in response to the
    number of quotes at the NBBO, 350us after reception of an incoming order. If you’re
    interested, the mechanics of the D-Peg are now disclosed. They’re on p210 of this
    [pdf](http://www.sec.gov/rules/other/2015/investors-exchange-form-1-exhibits-a-e.pdf)
    from IEX’s exchange [application](http://www.sec.gov/rules/other/2015/investors-exchange-form-1.htm).'
  prefs: []
  type: TYPE_NORMAL
- en: '[[3](#3iexpeg)] A few ways the figures differ from IEX primary pegs:'
  prefs: []
  type: TYPE_NORMAL
- en: The NBBO is different from the Nasdaq BBO. Adding in venues with inverted pricing
    (Bx,EdgeA,BatsY) should make this edge larger.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Different exchanges and different order types have different populations of
    traders.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A market data message takes time to get from Nasdaq to IEX’s system. The details
    may bore you, but IEX’s speed advantage will vary by exchange. Messages from Carteret
    to Weehawken on commodity [fiber](http://hudsonfiber.com/downloads/HFN_world-map-8.5x11.pdf)
    take about 180us 1-way. On a [wireless](http://www.nasdaqtrader.com/content/Productsservices/trading/CoLo/ExpressConnectFS.pdf)
    network, messages from Carteret to IEX’s POP in Secaucus probably take about 90us.
    So HFTs may receive Nasdaq messages around 90us before IEX does, which means that
    IEX arguably has a 260us headstart (350us – 90us) for reacting to Nasdaq. For
    the 4 Bats exchanges in Secaucus, IEX will essentially have the full 350us head
    start. For the NYSE exchanges, IEX should have a smaller advantage. And IEX may
    receive market data from CHX (in Chicago) well after high-speed traders do, if
    any bother to send it wirelessly to NJ. There’s also nothing stopping IEX from
    getting its market data over wireless, which would give them the full head start
    for messages from every exchange, and would be a tiny [expense](http://images.qnasdaqomx.com/Web/NASDAQOMX/%7B7a771fbc-7e3f-4ec7-9bb0-fba9938b7fb9%7D_MMWfaqs_August_2015_-_clean.pdf)
    by their [standards](http://www.bloomberg.com/news/articles/2014-09-03/steve-wynn-joins-bain-capital-in-financing-iex-dark-pool).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[[4](#4iexpeg)] For readers who have experience with software, here’s an analogy:'
  prefs: []
  type: TYPE_NORMAL
- en: Let’s say that you have some multi-threaded software. The software processes
    a stream of two types of events, A and B. Sometimes, events of Type A occur slightly
    before those of Type B, but the Type A event processing tends to be slower. Because
    of that slowness, the software often finishes the Type B events first. That causes
    events to be handled out of order, and has bad consequences. Your measurements
    show that Type A’s processing is typically slower than Type B’s by 100us, but
    never more than 300us. So, you decide to delay all Type B events by 350us, because
    that will make sure they can never beat any Type A events which occurred first.
    You’re very proud of yourself, and tell your customers that their synchronization
    problems are over.
  prefs: []
  type: TYPE_NORMAL
- en: If “Type A” events are NBBO changes that cause you to reprice peg orders, and
    “Type B” events are all other customer orders, then this analogy is close to the
    idea of exchange speedbumps. The problem, of course, is that now the “Type B”
    orders have a speed disadvantage, which means, if the price moves away shortly
    after they were received, that they can’t match with peg orders. There are methods
    to properly deal with these situations in software. It’s just that adding a constant
    delay to select events isn’t one of them.
  prefs: []
  type: TYPE_NORMAL
- en: '[[5](#5iexpeg)] Here’s another example of a pretty dumb strategy that only
    an HFT could try:'
  prefs: []
  type: TYPE_NORMAL
- en: The NBBO for a stock is set by Nasdaq at 10.00/10.05.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: An HFT observes a hidden trade on Nasdaq at 10.03.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The HFT knows that there is probably still hidden liquidity available at 10.03,
    because resting hidden orders tend to be large.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The passive side of the hidden trade isn’t distributed in market data. But the
    HFT has a model which estimates that there’s a 70% chance that the resting side
    is the bid.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If the HFT were more confident about that estimate, it could submit a midpoint
    buy order to Bats, which could get filled at 10.025, lower than the price the
    hidden order just paid. However, the 30% chance that the estimate is wrong is
    too high — If somebody sends large sell orders checking for hidden liquidity at
    Bats, and shortly afterwards sweeps the Nasdaq bid, the HFT will be stuck with
    a toxic fill.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The HFT submits a midpoint buy peg to IEX instead.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, if their guess is wrong, they’re protected. When IEX receives the same
    aggressive order checking for hidden liquidity, it holds it for 350us. While holding
    onto that order, IEX sees the Nasdaq bid swept, and pulls the HFT’s midpoint order.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If the HFT’s guess is right, and someone sends large sell orders to IEX and
    Nasdaq, the hidden order at Nasdaq will trade at 10.03, leaving the displayed
    bid intact. The HFT’s order will execute at IEX at 10.025, a better price than
    the hidden order received.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[[6](#6iexpeg)] In addition to peg orders backing away from fills after market
    conditions deteriorate, it’s possible that IEX uses non-delayed data to help peg
    orders aggressively trade against resting liquidity, potentially “picking off”
    orders on their own exchange. I previously [blogged](https://mechanicalmarkets.wordpress.com/2015/08/11/iex-ideology-and-the-role-of-an-exchange/#3iex2)
    about this “book recheck” feature. “Book rechecks” could offer conditionality
    to sophisticated traders wanting to remove liquidity before specific future events.'
  prefs: []
  type: TYPE_NORMAL
