<!--yml
category: 未分类
date: 2024-05-18 14:25:13
-->

# Good Knight – Sniper In Mahwah & friends

> 来源：[https://sniperinmahwah.wordpress.com/2013/11/02/good-knight/#0001-01-01](https://sniperinmahwah.wordpress.com/2013/11/02/good-knight/#0001-01-01)

Contrairement à ce que le silence de ce blog laisse penser, nous sommes revenus de vacances il y a bien longtemps déjà – il est tout simplement compliqué et chronophage d’écrire un livre tout en écrivant parallèlement des billets sur des sujets aussi (parfois) retors que les transactions à haute fréquences. Pour fêter notre retour numérique, voilà un bref compte rendu de la [condamnation](http://www.sec.gov/litigation/admin/2013/34-70694.pdf) de Knight Capital par la SEC suite au dysfonctionnement qu’a connu le *market maker* le 1er août 2012, qui lui a fait perdre 461 millions de dollars en 40 minutes. L’événement avait (légitimement) fait beaucoup coulé beaucoup d’encre à l’époque, et les raisons de la condamnation de Knight (à 12 millions de dollars d’amende) sont particulièrement intéressantes, en ce sens qu’elles sont à la fois complètement en lien avec les hautes fréquences… et dans le même temps pas du tout.

**Retail Liquidity Program (Nyse)**

Ce 1er août 2012, le New York Stock Exchange mettait en route un nouveau programme intitulé Retail Liquidity Program (RPL). Fruit de deux ans de discussions serrées avec la SEC – d’après un responsable du NYSE –, l’objectif du RPL était de permettre aux particuliers d’avoir des meilleurs prix de cotation/transaction que ceux apparaissant dans le carnet d’ordre central des plateformes du NYSE (Nyse ou Nyse-Arca). Les deux ans de discussion avec le régulateur américain s’expliquent par l’aspect controversé du programme : en proposant un prix différent de ceux des marchés dits « éclairés » (les 13 plateformes de négociations américaines), ce programme destiné aux particuliers (et non aux *market makers*) était dès le début critiqué du fait de sa forte ressemblance avec les « dark pools », ces « bourses de l’ombre » (au nombre d’une cinquantaine aux Etats-Unis) qui désignent un ensemble de plateformes où les transactions sont complètement anonymes et les prix non publics – ces dark pools peuvent prendre la forme de plateformes comme Sigma-X (Goldman Sachs) ou Crossfinder (Crédit Suisse), mais aussi d’internalisateurs, i.e. des plateformes internes aux banques ou aux *market makers *qui apparient les ordres de leurs client en interne plutôt que de les faire router vers les 13 marchés éclairés américains… ou d’autres dark pools.

Passons sur la controverse qui entoure chaque jour davantage les dark pools – de plus en plus de transactions ont lieu dans ces bourses de l’ombre, ce qui inquiète à la fois les régulateurs… et les marchés éclairés car les dark pools sont des concurrents directs des marchés traditionnels, qui voient ainsi leur flux diminuer –, pour simplement préciser que le PDG de NYSE, Duncan Niederauer, s’était montré assez virulent contre ces concurrents de l’ombre, ce que n’ont pas manqué de rappeler les opposants au Retail Liquidity Program. En avalisant le RLP, la SEC a autorisé une dérogation à la règle dite du *sub-penny rule* (intégrée dans Reg NMS), qui interdit à une place boursière de recevoir des ordres au-delà d’1 dollar de plus ou de moins que la cotation du moment, et en-deça d’un centime de dollars. Concrètement, un titre cotée à 20,50 dollars ne peut donner lieu à une transaction qu’entre 19,50 dollars et 21,50 dollars *a minima*, ou entre 20,49 et 20,51 dollars *a maxima*. Reg NMS interdit donc le pas de cotation (*tick*) en dessous d’1 *cent*. Grâce à cette exception accordée par la SEC, le RLP du NYSE est autorisé à ramener le pas de cotation à 1 centième de dollar, ce qui affine le prix – l’action à 20,50 dollars peut ainsi être achetée ou vendue à 20,4999 ou 20,5001 dollars, une fourchette bien plus précise que celle permise dans le carnet d’ordre « standard » des plateformes.

Cette « discrétisation » du prix (ou *discret* doit être entendu au sens scientifique du terme) est un vaste sujet si on la replace dans l’histoire de l’arrivée des machines au sein des marchés financiers (nous sommes loin du temps où, dans les années 1990, le pas de cotation était d’un huitième de dollar : pour une action cotée à 20,50 dollars, il était impossible de faire une offre entre 20,25  et 20,50 dollars, ou entre 20,50 et 20,75 dollars). Le Retail Liquidity Program, d’après le NYSE, devait être capable d’offrir des prix améliorés de 1,4 centimes de dollars en moyenne, et ce pour les particuliers passant directement leurs ordres sur les plateformes Nyse et Nyse-Arca. Le programme fut avalisé par la SEC en juin 2012, et sa mise en route prévue le 1er août 2012, ce qui laissait un peu de temps aux passeurs d’ordre pour mettre à jour leur connexion avec ces plateformes (depuis, le Nasdaq et Bats ont eu eux aussi l’autorisation de passer outre la *sub-penny rule*).

**Routage et information**

D’après le rapport assez ébouriffant de la SEC sur le Knightmare de ce jour-là, la débâcle de l’un des plus solides *market makers* de Wall Street est la conséquence d’un enchaînement de manquements à la vigilance dont le rapport donne quelques détails croustillants. En résumé :

– Afin de pouvoir se connecter sans problème avec le RLP, Knight Capital a été obligé de mettre à jour SMARS, le routeur hyper-rapide permettant d’envoyer des ordres vers les marchés. Concrètement, SMARS dispatche un ordre « parent » venu de Knight en ordres « enfants » destinés à être exécutés sur une ou plusieurs plateformes de négociation. Ce nouveau code algorithmique de routage devait remplacer une fonction intitulée « Power Peg » que Knight n’utilisait plus depuis 2003 mais dont le code était resté implanté dans les routeurs (premier problème). Le rôle de Power Peg était de faire remonter l’information concernant les ordres enfants : si ceux-ci donnaient lieu à des transactions sur telle ou telle plateforme, alors (pour faire court) l’ordre parent en était informé et enlevait ces ordres enfants de la liste des ordre à exécuter. Rien de compliqué.

– Le 27 juillet 2012, Knight commença à déployer son nouvel algorithme de routage vers le RLP sur ses routeurs tests… mais « durant le déploiement de ce nouveau code, un technicien n’a pas copié le nouveau code dans l’un des huit serveurs de SMARS », selon la SEC. *Errare humanum est.* C’est d’autant plus impressionnant qu’aucun dispositif de contrôle de l’implémentation de ce nouveau code n’avait été prévu par Knight Capital. Un serveur de SMARS a donc conservé son ancien code… lequel avait été entre-temps « déménagé » à un autre endroit du code général d’exécution (deuxième problème).

– Arrive le 1er août 2012 : SMARS se connecte au RPL tout en recevant les ordres des clients de Knight. Les sept serveurs avec le nouveau code de routage fonctionnent parfaitement… mais pas le huitième, qui se met à réactiver (de fait) Power Peg, les anciennes lignes de code de routage qui non seulement étaient obsolètes pour le RLP mais dont l’exécution était par ailleurs périlleuse compte tenu de leur déménagement. Conséquence (toujours pour faire court) : le septième serveur ne faisait pas remonter l’information sur l’exécution ou non des ordres enfants, ceux-ci apparaissaient donc aux yeux de l’ordre parent comme n’étant jamais exécutés. Ces ordres étaient donc tous renvoyés vers les marchés, qu’ils aient été exécutés ou non, en boucle. Oups.

– Dans le détail : 212 ordres parents ont donné lieu à… des millions d’ordres enfants, donnant lieu à 4 millions de transactions sur 154 titres différents, ce qui représente 397 millions d’actions en 45 minutes – c’est du joli. On se dit alors que 461 millions de dollars de perte ne sont pas grand-chose par rapport aux… 6,65 milliards de dollars de positions (non voulues évidemment) détenues par Knight quelques minutes avant la fin des événements. On sera également surpris de constater (si la SEC dit juste) que 97 mails d’alerte (dont l’objet était « *Power Peg disabled* ») furent envoyés entre 08h01 et 09h30 (heure d’ouverture des marchés) à certains membres du personnel de Knight – 1) soit ces gens dormaient, 2) soit ils tentèrent de résoudre le problème sans succès, activant malgré tout la connexion avec le Retail Liquidity Program du NYSE. Tous ces manquements sont détaillés et sanctionnés dans le rapport de la SEC.

*Errare humanum est, perseverare diabolique* : « L’erreur est humaine, persévérer dans son erreur est diabolique » dit l’adage… et c’est malgré tout ce que fit Knight à un certain moment (le point le plus ahurissant de l’histoire) : en tentant de résoudre cette cacophonie, Knight décida de désactiver le nouveau code de routage des 7 serveurs qui fonctionnaient pourtant parfaitement, et de fait Power Peg, l’ancien code désormais défectueux, prit le relais, enfonçant Knight dans ses problèmes (c’est sans doute à ce moment-là que la compagnie se retrouva avec des positions comptées en milliards de dollars). Au-delà des détails techniques, la morale de l’histoire est celle-ci : une défaillance humaine concernant un seul algorithme de routage d’un seul serveur d’un seul opérateur peut avoir des conséquences, dans les marchés, sur la cotation de 75 titres dont Knight Capital fit bouger le cours de plus de 5% (plus de 10% pour 37 d’entre elles). Dans un univers où les machines travaillent vite et bien, une seule petite erreur humaine peut mener à la catastrophe.

**And the winner is… Goldman Sachs**

La condamnation de la SEC a été jugée par certains comme « infâmante » : perdre 461 millions de dollars était suffisant, nul besoin d’y ajouter une amende. Par ailleurs, certains ordres auraient pu être purement et simplement annulés par les marchés, et spécialement par le NYSE (compte de l’ampleur de la débâcle, une annulation complète aurait été sans doute compliquée). Knight fut rapidement renfloué par Goldman Sachs avant que Getco, l’une des plus importantes compagnie de trading à hautes fréquences américaines, ne la rachète (du pain béni pour Getco qui a perdu 80% de ses bénéfices depuis fin 2012 dans ses activités à hautes fréquences mais qui prend possession d’un *market maker* efficace malgré le *bug* humain).

Le 20 août 2013, peu après des problèmes techniques qui obligèrent le Nasdaq à fermer purement et simplement, Goldman Sachs eut également un *glitch* (pas un *bug* ;) avec l’exécution de certains ordres concernant les options, ce qui déstabilisa les marchés et occasionna une perte de plus de 10 millions de dollars pour la banque. Et là, comme par un miracle commandé par la firme qui « accomplit l’œuvre de Dieu », la plupart des ordres furent annulés par le NYSE, le Nasdaq, le CBOE et ISE. L’être humain qui a oublié de mettre à jour le huitième serveur de Knight Capital a du sauter de joie à l’annonce de cette bonne nouvelle.