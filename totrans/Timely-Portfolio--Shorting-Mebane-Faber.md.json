["```\nrequire(quantmod)\nrequire(PerformanceAnalytics)   #completely from the PerformanceAnalytics package chart.RiskReturn\n#cannot claim any of the credit for the fine work in this package   chart.DrawdownReturn <- function (R, Rf = 0, main = \"Annualized Return and Worst Drawdown\", add.names = TRUE, \n    xlab = \"WorstDrawdown\", ylab = \"Annualized Return\", method = \"calc\", \n    geometric = TRUE, scale = NA, add.sharpe = c(1, 2, 3), add.boxplots = FALSE, \n    colorset = 1, symbolset = 1, element.color = \"darkgray\", \n    legend.loc = NULL, xlim = NULL, ylim = NULL, cex.legend = 1, \n    cex.axis = 0.8, cex.main = 1, cex.lab = 1, ...) \n{\n    if (method == \"calc\") \n        x = checkData(R, method = \"zoo\")\n    else x = t(R)\n    if (!is.null(dim(Rf))) \n        Rf = checkData(Rf, method = \"zoo\")\n    columns = ncol(x)\n    rows = nrow(x)\n    columnnames = colnames(x)\n    rownames = rownames(x)\n    if (length(colorset) < columns) \n        colorset = rep(colorset, length.out = columns)\n    if (length(symbolset) < columns) \n        symbolset = rep(symbolset, length.out = columns)\n    if (method == \"calc\") {\n        comparison = cbind(t(Return.annualized(x[, columns:1])),\n\t\tt(maxDrawdown(x[, columns:1])))\n        returns = comparison[, 1]\n        risk = comparison[, 2]\n        rnames = row.names(comparison)\n    }\n    else {\n        x = t(x[, ncol(x):1])\n        returns = x[, 1]\n        risk = x[, 2]\n        rnames = names(returns)\n    }\n    if (is.null(xlim[1])) \n        xlim = c(0, max(risk) + 0.02)\n    if (is.null(ylim[1])) \n        ylim = c(min(c(0, returns)), max(returns) + 0.02)\n    if (add.boxplots) {\n        original.layout <- par()\n        layout(matrix(c(2, 1, 0, 3), 2, 2, byrow = TRUE), c(1, \n            6), c(4, 1), )\n        par(mar = c(1, 1, 5, 2))\n    }\n    plot(returns ~ risk, xlab = \"\", ylab = \"\", las = 1, xlim = xlim, \n        ylim = ylim, col = colorset[columns:1], pch = symbolset[columns:1], \n        axes = FALSE, ...)\n    if (ylim[1] != 0) {\n        abline(h = 0, col = element.color)\n    }\n    axis(1, cex.axis = cex.axis, col = element.color)\n    axis(2, cex.axis = cex.axis, col = element.color)\n    if (!add.boxplots) {\n        title(ylab = ylab, cex.lab = cex.lab)\n        title(xlab = xlab, cex.lab = cex.lab)\n    }\n    if (!is.na(add.sharpe[1])) {\n        for (line in add.sharpe) {\n            abline(a = (Rf * 12), b = add.sharpe[line], col = \"gray\", \n                lty = 2)\n        }\n    }\n    if (add.names) \n        text(x = risk, y = returns, labels = rnames, pos = 4, \n            cex = 0.8, col = colorset[columns:1])\n    rug(side = 1, risk, col = element.color)\n    rug(side = 2, returns, col = element.color)\n    title(main = main, cex.main = cex.main)\n    if (!is.null(legend.loc)) {\n        legend(legend.loc, inset = 0.02, text.col = colorset, \n            col = colorset, cex = cex.legend, border.col = element.color, \n            pch = symbolset, bg = \"white\", legend = columnnames)\n    }\n    box(col = element.color)\n    if (add.boxplots) {\n        par(mar = c(1, 2, 5, 1))\n        boxplot(returns, axes = FALSE, ylim = ylim)\n        title(ylab = ylab, line = 0, cex.lab = cex.lab)\n        par(mar = c(5, 1, 1, 2))\n        boxplot(risk, horizontal = TRUE, axes = FALSE, ylim = xlim)\n        title(xlab = xlab, line = 1, cex.lab = cex.lab)\n        par(original.layout)\n    }\n}     getSymbols(\"DJIA\",src=\"FRED\")\n#if you prefer Yahoo! Finance\n#getSymbols(\"^DJI\",from=\"1919-01-01\",to=Sys.Date())   DJIA <- to.monthly(DJIA)[,4]\nindex(DJIA) <- as.Date(index(DJIA))   signalUp <- ifelse(DJIA > runMean(DJIA,n=10), 1, 0)\nsignalDown <- ifelse(DJIA < runMean(DJIA,n=10), -1, 0)   retUp <- lag(signalUp,k=1)* ROC(DJIA,type=\"discrete\",n=1)\nretDown <- lag(signalDown, k=1) * ROC(DJIA,type=\"discrete\",n=1)\nret <- merge(retUp + retDown,retUp,retDown,-retDown,ROC(DJIA,type=\"discrete\",n=1))\ncolnames(ret) <- c(\"Combined\",\"LongAbove\",\"ShortBelow\",\"LongBelow\",\"DJIA\")   #jpeg(filename=\"performance summary all.jpg\",quality=100,\n#\twidth=6.25, height = 6.25,  units=\"in\",res=96)\ncharts.PerformanceSummary(ret,ylog=TRUE,\n\tcolorset=c(\"cadetblue\",\"darkolivegreen3\",\"goldenrod\",\"purple\",\"gray70\"),\n\tmain=\"DJIA 10 Month Moving Average Strategy Comparisons\n\tMay 1896-Jun 2011\")\n#dev.off()\n#jpeg(filename=\"performance summary before 1932.jpg\",quality=100,\n#\twidth=6.25, height = 6.25,  units=\"in\",res=96)\ncharts.PerformanceSummary(ret[\"::1932-06\",3],ylog=TRUE,\n\tmain=\"DJIA Short Below 10 Month Moving Average Works\n\tMay 1896-Jun 1932\")\n#dev.off()\n#jpeg(filename=\"performance summary after 1932.jpg\",quality=100,\n#\twidth=6.25, height = 6.25,  units=\"in\",res=96)\ncharts.PerformanceSummary(ret[\"1932-07::\",3],ylog=TRUE,\n\tmain=\"DJIA Short Below 10 Month Moving Average Fails\n\tJul 1932-Jun 2011\")\n#dev.off()   #jpeg(filename=\"drawdown annualized return scatter.jpg\",quality=100,\n#\twidth=6.25, height = 6.25,  units=\"in\",res=96)\nchart.DrawdownReturn(ret[,1:5])\n#dev.off()   #look at risk measures\nrequire(ggplot2)\n#jpeg(filename=\"risk.jpg\",quality=100,width=6.25, height = 5, \n#\tunits=\"in\",res=96) \ndownsideTable<-table.DownsideRisk(ret)\ndownsideTable<-melt(cbind(rownames(downsideTable),\n\tdownsideTable))\ncolnames(downsideTable)<-c(\"Statistic\",\"Portfolio\",\"Value\")\nggplot(downsideTable, stat=\"identity\",\n\taes(x=Statistic,y=Value,fill=Portfolio)) +\n\tgeom_bar(position=\"dodge\") + coord_flip()\n#dev.off()\n```"]