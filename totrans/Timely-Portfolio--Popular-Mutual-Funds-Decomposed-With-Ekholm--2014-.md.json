["```\n# perform Ekholm (2012,2014) analysis on some popular mutual funds\n\n# Ekholm, A.G., 2012\n# Portfolio returns and manager activity:\n#    How to decompose tracking error into security selection and market timing\n# Journal of Empirical Finance, Volume 19, pp 349-358\n\n# Ekholm, Anders G., July 21, 2014\n# Components of Portfolio Variance:\n#    R2, SelectionShare and TimingShare\n# Available at SSRN: http://ssrn.com/abstract=2463649\n\nlibrary(Quandl)  # use to get Fama/French factors\nlibrary(pipeR)   # pipes are the future or R\nlibrary(rlist)   # rlist - like underscore/lodash for R lists\nlibrary(dplyr)   # super fast and really powerful\nlibrary(tidyr)   # next gen wide/long formatter package\nlibrary(latticeExtra) # old but still awesome\nlibrary(directlabels) # fantastic and works with ggplot & lattice\nlibrary(quantmod) # also will load xts\n\n# use Quandl Kenneth French Fama/French factors\n# http://www.quandl.com/KFRENCH/FACTORS_D\nf <- Quandl(\"KFRENCH/FACTORS_D\",type = \"xts\") / 100\n\n# grab our function from post\n# http://timelyportfolio.blogspot.com/2014/10/selectionshare-timingshare-masterfully.html\ndevtools::source_gist(\"e5728c8c7fb45dbdb6e0\")\n\ntickers <- c( \"FCNTX\", \"AGTHX\", \"SEQUX\", \"FPACX\" )\nekFunds <-  lapply(\n  tickers\n  ,function(ticker) {\n    ticker %>>%\n      getSymbols( from = \"1896-01-01\", auto.assign = F ) %>>%\n      (fund ~  \n         structure(\n           fund[,6] / stats::lag( fund[,6], 1 ) - 1\n           ,dimnames = list(NULL,gsub(x = colnames(fund)[6], pattern  = \"[\\\\.]Adjusted\", replacement = \"\"))\n         )\n      ) %>>%\n      merge( f ) %>>% #  Quandl(\"KFRENCH/FACTORS_D\",type = \"xts\") / 100\n      na.omit %>>%\n      rollapply (\n        FUN= function(x){\n          x %>>%\n            jensen_ekholm %>>% \n            ( data.frame( summary(.[[\"linmod\"]])$\"r.squared\" , .$ekholm ) )  %>>%\n            xts(order.by=tail(index(x),1)) -> return_df\n          colnames(return_df)[1] <- \"R_sq\"\n          return(return_df)\n        }\n        , width = 500\n        #, by = 100\n        , by.column=F\n        , fill = NULL\n      ) %>>%\n      na.fill(0)\n  }\n)\nnames(ekFunds) \nekFunds %>>%\n  list.map(\n    {\n      structure(\n        data.frame(\n          date = index(.)\n          , fund = names(ekFunds)[.i]\n          , .\n        )\n      ) %>>%\n        gather(measure,value,-date,-fund)\n    }\n  ) %>>%\n  (\n    do.call( rbind , . )\n  ) -> ekT\n\nekT %>>%\n  # just plot at R^2, SelectionShare, and TimingShare\n  filter( measure %in% c(\"R_sq\",\"SelectionShare\",\"TimingShare\") ) %>>%\n  (\n    xyplot(\n      value ~ date | measure\n      , groups = fund\n      , data = .\n      , type = \"l\"\n      # using direct.label so not necessary\n      , auto.key = list( space = \"right\" )\n      # title our plot\n      , main = paste(\n        \"Comparison of Ekholm Decomposition for Various Mutual Funds\"\n        ,paste0(\"2 Year Rolling since \",format(.$date[1],format=\"%b %d, %Y\"))\n        ,sep=\"\\n\"\n      )\n      # layout one on top of the other\n      , layout = c(1,length(unique(.$measure)))\n    )\n  ) %>>%\n  # I like labels on plot rather than legend\n  directlabels::direct.label( method = \"last.qp\" ) %>>%\n  # pretty it up with the latticeExtra Economist theme\n  asTheEconomist\n\n```"]