- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-13 00:15:22'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: Finite-Difference Solver for the SABR Model – HPC-QuantLib
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://hpcquantlib.wordpress.com/2019/01/11/finite-difference-solver-for-the-sabr-model/#0001-01-01](https://hpcquantlib.wordpress.com/2019/01/11/finite-difference-solver-for-the-sabr-model/#0001-01-01)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Despite being based on a fairly simple stochastic differential equation
  prefs: []
  type: TYPE_NORMAL
- en: '![\begin{array}{rcl} \displaystyle dF_t &=& \alpha_t F_t^\beta dW_t \\ \nonumber
    d\alpha_t &=& \nu \alpha_t dZ_t \\ \nonumber \rho dt &=& <dW_t, dZ_t> \end{array}](img/47f376178554f45c17eb815238974e7b.png)'
  prefs: []
  type: TYPE_IMG
- en: the corresponding partial differential equation
  prefs: []
  type: TYPE_NORMAL
- en: '![\displaystyle \frac{\partial u}{\partial t} - \frac{\nu^2}{2}\frac{\partial
    u}{\partial x} + \frac{1}{2}e^{2x}F_t^{2\beta}\frac{\partial^2 u}{\partial F^2}+\frac{\nu^2}{2}\frac{\partial^2
    u}{\partial x^2}+\rho\nu e^{x_t}F_t^\beta\frac{\partial^2 u}{\partial F \partial
    x} -ru = 0 ](img/f9d758067f04ecadb094460842f201c6.png)'
  prefs: []
  type: TYPE_IMG
- en: for the SABR model – derived using the variable transformation ![x_t = \ln \alpha_t](img/ae304008116ffa91bf6949deda15d7ba.png)
    together with Ito’s lemma and the Feynman-Kac formula – is quite difficult to
    solve numerically. Part of the problem is the process of the underlying, which
    corresponds to a constant elasticity of variance (CEV) model if ![\nu](img/cafd388c0e801cfe79db6142b0511d49.png)
    is zero. This model exhibits a variety of different behaviours depending on the
    value of ![\beta](img/5e11b317f8192df3c4b3952a8bb706c4.png) and on the boundary
    conditions. The authors in [1] give a comprehensive overview on this topic. To
    limit the possible model zoo let’s define
  prefs: []
  type: TYPE_NORMAL
- en: '![\displaystyle X\left(F_t\right) = X_t=\frac{F_t^{2(1-\beta)}}{\alpha^2(1-\beta)^2}
    \ \wedge \  \delta=\frac{1-2\beta}{1-\beta}](img/04768925906145d1cdcd7c0a5ca72e06.png)'
  prefs: []
  type: TYPE_IMG
- en: and assume absorbing boundary conditions at ![X=0](img/a524ae337c36d7dcea7505818949fd39.png)
    if ![\delta < 2](img/80ac2ceded793106f743af6be261d02b.png). First step for an
    implementation of a finite difference scheme is to find efficient limits for the
    discretization grid. These limits can e.g. be derived from the cumulative distribution
    function of the underlying process.
  prefs: []
  type: TYPE_NORMAL
- en: '![\textrm{Pr}(F \le F_t | F_0) = \begin{cases} 1-{\chi ''}^{2}\left( \frac{X_0}{t};
    2-\delta, \frac{X_t}{t}\right), & \textrm{if} \ \delta < 2 \\ \nonumber 1 - {\chi
    ''}^{2}\left( \frac{X_t}{t}; \delta, \frac{X_0}{t}\right), & \textrm{if}  \ \delta
    > 2 \end{cases} ](img/128f3e3c4856a7f40490d2be20462c1d.png).'
  prefs: []
  type: TYPE_NORMAL
- en: Please notice that the underlying ![X(F_t)](img/af6855ccdd123ebb57f6ac3a1c2ed7af.png)
    in the first case ![\delta < 2](img/80ac2ceded793106f743af6be261d02b.png) appears
    in the non centrality parameter of the non central chi-squared distribution ![{\chi
    '}^{2}](img/ed83c0e2bf1afcdb555871a2cd3b3bd3.png), hence the calculation of the
    inverse can only be carried out by a numerical root-finding algorithm. Sankaran’s
    approximation of the non central chi-squared distribution ![{\chi '}^{2} ](img/350ed103f48bcd711f1c4e5348fca9ce.png)
    can be used to speed-up this method [2]. In the second case ![\delta > 2](img/48f88eee049d1ff29eeb97157d9b90c3.png)
    the inverse of the equation ![\displaystyle \textrm{Pr}(F \le F_t | F_0) = q](img/dcdd880b7f5c005875518c96d3dec4ce.png)
    is
  prefs: []
  type: TYPE_NORMAL
- en: '![F_t= \left[{t \left({\chi''}^2\right)}^{-1} \left(1-q; \delta, \frac{X_0}{t}\right) 
    \alpha^2(1-\beta)^2\right]^{\frac{1}{2(1-\beta)}}](img/86867f2fe848ba93436b6c130fa2f9b7.png)'
  prefs: []
  type: TYPE_IMG
- en: which can be computed using the boost library. In addition adaptive grid refinement
    around important points and cell averaging around special points of the payoff
    at maturity [3] improve the accuracy of the CEV finite difference scheme. ![F_T](img/7f085e69b6bb3607bb8f532ade50591c.png)
    is only a local martingale when ![\delta > 2](img/48f88eee049d1ff29eeb97157d9b90c3.png)
    or equivalent ![\beta > 1](img/c298f856bf9a1a36e84d9c4b580a3ce4.png). In this
    case the call-put parity reads [1]
  prefs: []
  type: TYPE_NORMAL
- en: '![P_{\delta > 2} = C_{\delta>2} + K - F_0\Gamma\left(-\nu; \frac{X_0}{2t}\right)](img/c23b003525fc32fe420360dc30b67adc.png)'
  prefs: []
  type: TYPE_IMG
- en: and acts as a litmus test for the implementation of the boundary conditions
    and the finite difference scheme.
  prefs: []
  type: TYPE_NORMAL
- en: The variance direction ![x_t = \ln \alpha_t](img/ae304008116ffa91bf6949deda15d7ba.png)
    matches a Brownian motion, hence the discretization is straight forward. Operator
    splitting schemes like Craig-Sneyd or Hundsdorfer-Verwer [4] are tailor made to
    solve the two dimensional partial differential equation.
  prefs: []
  type: TYPE_NORMAL
- en: The finite difference solver can now be used to compare different approximations
    with the correct model behaviour and also to compare it with high accurate Monte-Carlo
    simulations [2]. The model configuration [5]
  prefs: []
  type: TYPE_NORMAL
- en: '![F_0=1.0, \alpha=0.35, \beta=0.25, \nu=1.0, \rho=0.25, T=2.0](img/c135481b2aa7ee9e4eba40d40ae17348.png)'
  prefs: []
  type: TYPE_IMG
- en: should act as a test bed. As can be seen in the diagram below the Monte-Carlo
    results are in line with the results from finite difference methods within very
    small error bars. The standard Hagan et al. formula as well as the Le Floc’h-Kennedy
    [6] log-normal formula deviate significantly from the correct implied volatilities.![implvol](img/163ae001da6390c0946673ad1433e057.png)
  prefs: []
  type: TYPE_NORMAL
- en: The approximations are not arbitrage free. The probability densities for small
    strikes turn negative. Hagan’s formula exhibits this behaviour already for larger
    strikes than the Le Floc’h-Kennedy formula as can be seen in the following diagram.
    As expected the finite difference solution does not produce negative probabilities.
  prefs: []
  type: TYPE_NORMAL
- en: '![propdensity2.png](img/dbf612e4d0905b46838a62f278746a1e.png)A note on the
    Floc’h-Kennedy approximation, the formula becomes numerically unstable around
    ATM strike levels, hence a second order Taylor expansion is used for moneyness'
  prefs: []
  type: TYPE_NORMAL
- en: '![m=\frac{F}{K}-1.0 \in \{-0.0025, 0.0025\}](img/b4e6694ce8fa8280589921bdaa9c0f9d.png).'
  prefs: []
  type: TYPE_NORMAL
- en: The following diagram shows the difference between second order Taylor expansion
    and the formula evaluated using IEEE-754 double precision.
  prefs: []
  type: TYPE_NORMAL
- en: '![taylor](img/ce847784f3dc93e75d5b30dce92b0ae9.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The source code is part of the PR #589 and available [here](https://github.com/lballabio/QuantLib/pull/589).'
  prefs: []
  type: TYPE_NORMAL
- en: '[1] D.R. Brecher, A.E. Lindsay: [Results on the CEV Process, Past and Present.](https://www.fincad.com/sites/default/files/wysiwyg/Resources-Wiki/cev-process-working-paper.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] B. Chen, C.W. Oosterlee, H. Weide, [Efficient unbiased simulation scheme
    for the SABR](http://ta.twi.tudelft.nl/mf/users/oosterle/oosterlee/SABRMC.pdf)
    [stochastic volatility model.](http://ta.twi.tudelft.nl/mf/users/oosterle/oosterlee/SABRMC.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '[3] K. in’t Hout: [Numerical Partial Differential Equations in Finance explained](https://www.palgrave.com/de/book/9781137435682).'
  prefs: []
  type: TYPE_NORMAL
- en: '[4] K. in’t Hout, S. Foulon: [ADI Finite Difference Schemes for Option Pricing
    in the Heston Model with Correlation.](http://www.math.ualberta.ca/ijnam/Volume-7-2010/No-2-10/2010-02-06.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '[5] P. Hagan, D. Kumar, A. Lesnieski, D. Woodward: [Arbitrage free SABR.](http://janroman.dhis.org/finance/SABR/Arbitrage-Free%20SABR.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '[6] F. Le Floc’h, G. Kennedy: [Explicit SABR Calibration through Simple Expansions](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2467231).'
  prefs: []
  type: TYPE_NORMAL
