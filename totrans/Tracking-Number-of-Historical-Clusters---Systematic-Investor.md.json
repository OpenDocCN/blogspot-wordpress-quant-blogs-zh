["```\n\n###############################################################################\n# Load Systematic Investor Toolbox (SIT)\n# https://systematicinvestor.wordpress.com/systematic-investor-toolbox/\n###############################################################################\nsetInternet2(TRUE)\ncon = gzcon(url('http://www.systematicportfolio.com/sit.gz', 'rb'))\n    source(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data for ETFs\n\t#****************************************************************** \n\tload.packages('quantmod')\n\n\ttickers = spl('GLD,UUP,SPY,QQQ,IWM,EEM,EFA,IYR,USO,TLT')\n\n\tdata <- new.env()\n\tgetSymbols(tickers, src = 'yahoo', from = '1900-01-01', env = data, auto.assign = T)\n\t\tfor(i in ls(data)) data[[i]] = adjustOHLC(data[[i]], use.Adjusted=T)\n\n\tbt.prep(data, align='remove.na')\n\n```", "```\n\n\t#*****************************************************************\n\t# Use following 3 methods to determine number of clusters\n\t# * Minimum number of clusters that explain at least 90% of variance\n\t#   cluster.group.kmeans.90\n\t# * Elbow method\n\t#   cluster.group.kmeans.elbow\n\t# * Hierarchical clustering tree cut at 1/3 height\n\t#   cluster.group.hclust\n\t#****************************************************************** \n\n\t# helper function to compute portfolio allocation additional stats\n\tportfolio.allocation.custom.stats.clusters <- function(x,ia) {\n\t\treturn(list(\n\t\t\tncluster.90 = max(cluster.group.kmeans.90(ia)),\n\t\t\tncluster.elbow = max(cluster.group.kmeans.elbow(ia)),\n\t\t\tncluster.hclust = max(cluster.group.hclust(ia))\n\t\t))\n\t}\n\n\t#*****************************************************************\n\t# Compute # Clusters\n\t#****************************************************************** \t\t\n\tperiodicity = 'weeks'\n\tlookback.len = 250\n\n\tobj = portfolio.allocation.helper(data$prices, \n\t\tperiodicity = periodicity, lookback.len = lookback.len,\n\t\tmin.risk.fns = list(EW=equal.weight.portfolio),\n\t\tcustom.stats.fn = portfolio.allocation.custom.stats.clusters\n\t) \n\n```", "```\n\n\t#*****************************************************************\n\t# Create Reports\n\t#****************************************************************** \t\t\n\ttemp = list(ncluster.90 = 'Kmeans 90% variance',\n\t\t ncluster.elbow = 'Kmeans Elbow',\n\t\t ncluster.hclust = 'Hierarchical clustering at 1/3 height')\t\n\n\tfor(i in 1:len(temp)) {\n\t\thist.cluster = obj[[ names(temp)[i] ]]\n\t\ttitle = temp[[ i ]]\n\n\t\tplota(hist.cluster, type='l', col='gray', main=title)\n\t\t\tplota.lines(SMA(hist.cluster,10), type='l', col='red',lwd=5)\n\t\tplota.legend('Number of Clusters,10 period moving average', 'gray,red', x = 'bottomleft')\t\t\t\n\t}\n\n```"]