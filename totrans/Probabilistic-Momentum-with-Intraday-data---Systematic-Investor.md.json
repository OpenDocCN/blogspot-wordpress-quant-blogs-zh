["```\n\n##############################################################################\n# Load Systematic Investor Toolbox (SIT)\n# https://systematicinvestor.wordpress.com/systematic-investor-toolbox/\n###############################################################################\nsetInternet2(TRUE)\ncon = gzcon(url('http://www.systematicportfolio.com/sit.gz', 'rb'))\n    source(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\t\n\n\t# data from http://thebonnotgang.com/tbg/historical-data/\n\t# please save SPY and GLD 1 min data at the given path\n\tspath = 'c:/Desktop/'\n\tdata = bt.load.thebonnotgang.data('SPY,GLD', spath)\n\n\tdata1 <- new.env()\t\t\n\t\tdata1$FI = data$GLD\n\t\tdata1$EQ = data$SPY\n\tdata = data1\n\tbt.prep(data, align='keep.all', fill.gaps = T)\n\n\tlookback.len = 120\n\tconfidence.level = 60/100\n\n\tprices = data$prices\n\t\tret = prices / mlag(prices) - 1 \n\n\tmodels = list()\n\n\t#*****************************************************************\n\t# Simple Momentum\n\t#****************************************************************** \n\tmomentum = prices / mlag(prices, lookback.len)\n\tdata$weight[] = NA\n\t\tdata$weight$EQ[] = momentum$EQ > momentum$FI\n\t\tdata$weight$FI[] = momentum$EQ <= momentum$FI\n\tmodels$Simple  = bt.run.share(data, clean.signal=T) \t\n\n\t#*****************************************************************\n\t# Probabilistic Momentum + Confidence Level\n\t# http://cssanalytics.wordpress.com/2014/01/28/are-simple-momentum-strategies-too-dumb-introducing-probabilistic-momentum/\n\t# http://cssanalytics.wordpress.com/2014/02/12/probabilistic-momentum-spreadsheet/\n\t#****************************************************************** \n\tir = sqrt(lookback.len) * runMean(ret$EQ - ret$FI, lookback.len) / runSD(ret$EQ - ret$FI, lookback.len)\n\tmomentum.p = pt(ir, lookback.len - 1)\n\n\tdata$weight[] = NA\n\t\tdata$weight$EQ[] = iif(cross.up(momentum.p, confidence.level), 1, iif(cross.dn(momentum.p, (1 - confidence.level)), 0,NA))\n\t\tdata$weight$FI[] = iif(cross.dn(momentum.p, (1 - confidence.level)), 1, iif(cross.up(momentum.p, confidence.level), 0,NA))\n\tmodels$Probabilistic  = bt.run.share(data, clean.signal=T) \t\n\n\tdata$weight[] = NA\n\t\tdata$weight$EQ[] = iif(cross.up(momentum.p, confidence.level), 1, iif(cross.up(momentum.p, (1 - confidence.level)), 0,NA))\n\t\tdata$weight$FI[] = iif(cross.dn(momentum.p, (1 - confidence.level)), 1, iif(cross.up(momentum.p, confidence.level), 0,NA))\n\tmodels$Probabilistic.Leverage = bt.run.share(data, clean.signal=T) \t\n\n\t#*****************************************************************\n\t# Create Report\n\t#******************************************************************        \n\tstrategy.performance.snapshoot(models, T)    \n\n```", "```\n\n\t#*****************************************************************\n\t# Hourly Performance\n\t#******************************************************************    \n\tstrategy.name = 'Probabilistic.Leverage'\n\tret = models[[strategy.name]]$ret\t\n\t\tret.number = 100*as.double(ret)\n\n\tdates = index(ret)\n\tfactor = format(dates, '%H')\n\n\tlayout(1:2)\n\tpar(mar=c(4,4,1,1))\n\tboxplot(tapply(ret.number, factor, function(x) x),outline=T, main=paste(strategy.name, 'Distribution of Returns'), las=1)\n\tbarplot(tapply(ret.number, factor, function(x) sum(x)), main=paste(strategy.name, 'P&L by Hour'), las=1)\n\n```", "```\n\n   \t#*****************************************************************\n   \t# Hourly Performance: Remove first return of the day (i.e. overnight)\n   \t#******************************************************************    \n   \tday.stat = bt.intraday.day(dates)\n\tret.number[day.stat$day.start] = 0\n\n   \tlayout(1:2)\n   \tpar(mar=c(4,4,1,1))\n\tboxplot(tapply(ret.number, factor, function(x) x),outline=T, main=paste(strategy.name, 'Distribution of Returns'), las=1)\n\tbarplot(tapply(ret.number, factor, function(x) sum(x)), main=paste(strategy.name, 'P&L by Hour'), las=1)\n\n```"]