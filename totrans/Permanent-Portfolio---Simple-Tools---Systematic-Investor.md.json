["```\n\n###############################################################################\n# Load Systematic Investor Toolbox (SIT)\n# https://systematicinvestor.wordpress.com/systematic-investor-toolbox/\n###############################################################################\nsetInternet2(TRUE)\ncon = gzcon(url('http://www.systematicportfolio.com/sit.gz', 'rb'))\n    source(con)\nclose(con)\n\n\t#*****************************************************************\n\t# Load historical data\n\t#****************************************************************** \n\tload.packages('quantmod')\t\n\ttickers = spl('SPY,TLT,GLD,SHY')\n\n\tdata <- new.env()\n\tgetSymbols(tickers, src = 'yahoo', from = '1980-01-01', env = data, auto.assign = T)\n\t\tfor(i in ls(data)) data[[i]] = adjustOHLC(data[[i]], use.Adjusted=T)\n\n\t\t# extend GLD with Gold.PM - London Gold afternoon fixing prices\n\t\tdata$GLD = extend.GLD(data$GLD)\n\n\tbt.prep(data, align='remove.na')\n\n\t#*****************************************************************\n\t# Setup\n\t#****************************************************************** \t\t\n\tprices = data$prices   \n\t\tn = ncol(prices)\n\n\tperiod.ends = endpoints(prices, 'quarters')\n\t\tperiod.ends = period.ends[period.ends > 0]\t\t\n\t\tperiod.ends = c(1, period.ends)\n\n\tmodels = list()\n\n\t#*****************************************************************\n\t# Dollar Weighted\n\t#****************************************************************** \t\t\t\n\ttarget.allocation = matrix(rep(1/n,n), nrow=1)\n\tweight.dollar = ntop(prices, n)\n\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = weight.dollar[period.ends,]\n\tmodels$dollar = bt.run.share(data, clean.signal=F)\n\n```", "```\n\n\t#*****************************************************************\n\t# Dollar Weighted + 7% target volatility\n\t#****************************************************************** \t\t\t\t\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = target.vol.strategy(models$dollar,\n\t\t\t\t\t\tweight.dollar, 7/100, 21, 100/100)[period.ends,]\n\tmodels$dollar.target7 = bt.run.share(data, clean.signal=F)\n\n```", "```\n\n\t#*****************************************************************\n\t# Risk Weighted\n\t#****************************************************************** \t\t\t\t\n\tret.log = bt.apply.matrix(prices, ROC, type='continuous')\n\thist.vol = sqrt(252) * bt.apply.matrix(ret.log, runSD, n = 21)\t\n\tweight.risk = weight.dollar / hist.vol\n\t\tweight.risk = weight.risk / rowSums(weight.risk)\n\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = weight.risk[period.ends,]\n\tmodels$risk = bt.run.share(data, clean.signal=F)\n\n```", "```\n\n\t#*****************************************************************\n\t# Market Filter (tactical): 10 month moving average\n\t#****************************************************************** \t\t\t\t\n\tperiod.ends = endpoints(prices, 'months')\n\t\tperiod.ends = period.ends[period.ends > 0]\t\t\n\t\tperiod.ends = c(1, period.ends)\n\n\tsma = bt.apply.matrix(prices, SMA, 200)\n\tweight.dollar.tactical = weight.dollar * (prices > sma)\t\n\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = weight.dollar.tactical[period.ends,]\n\tmodels$dollar.tactical = bt.run.share(data, clean.signal=F)\n\n```", "```\n\n\t#*****************************************************************\n\t# Tactical + 7% target volatility\n\t#****************************************************************** \t\t\t\t\n\tdata$weight[] = NA\n\t\tdata$weight[period.ends,] = target.vol.strategy(models$dollar.tactical,\n\t\t\t\t\t\tweight.dollar.tactical, 7/100, 21, 100/100)[period.ends,]\n\tmodels$dollar.tactical.target7 = bt.run.share(data, clean.signal=F)\n\n\t#*****************************************************************\n\t# Create Report\n\t#******************************************************************       \n\tplotbt.custom.report.part1(models)       \n\n\tplotbt.strategy.sidebyside(models)\t\n\n```"]