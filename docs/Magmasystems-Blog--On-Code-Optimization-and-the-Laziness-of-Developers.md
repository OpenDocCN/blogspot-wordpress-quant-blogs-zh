<!--yml

类别：未分类

日期：2024-05-18 05:02:01

-->

# 火山系统博客：关于代码优化和开发者的懒惰

> 来源：[`magmasystems.blogspot.com/2008/06/on-code-optimization-and-laziness-of.html#0001-01-01`](http://magmasystems.blogspot.com/2008/06/on-code-optimization-and-laziness-of.html#0001-01-01)

一个非常聪明的人，我们更重要的一些交易框架的拥有团队的管理者，曾经对我说：“我不知道我们为什么要花这么多精力去研究硬件加速。如果我们真的深入到我们的代码中，

refactored

它，并优化它，我们可能能够将端到端的性能提高 50%。”

我一直认为，继续使用高级、面向对象编程语言使得平均程序员变得懒惰。也许是因为不断推出版本的压力，但最近我看到的某些代码简直是糟糕透顶。游戏程序员如果看到其中的一些代码，会感到厌恶。很多从 C（甚至 C++）开始编程的人也会有同感。

我从 1984 年开始从事专业编程。我的第一个商业产品，一个 UNIX 和 PC 上的文字处理器，必须在 128K 的 RAM 中运行。我无法告诉你，我在地铁上花了多少个小时，翻看代码文件，看看我能在一个或两个函数中做出哪些优化。那种整个优化意识的文化似乎已经淡出了。

然而，放心吧，企业程序员先生。我发现问题的不仅仅是你的代码。

上周五，我从管理模式切换到代码优化模式。我想优化我们系统中的一个关键部分。我们的系统是用 C#编写的，所以我们正在使用.NET

SDK

由供应商提供。我注意到，提供

SDKs

对于 Java、C++和 C#通常会将对 C#

SDK

作为二等公民。我之前写过关于这个话题的博客，在这个案例中，我觉得这个供应商也没有什么不同。当我调试供应商的代码时，我惊讶地发现了一些事情，在 30 分钟的时间里，我已经给供应商发了六封电子邮件。

我发现了一些像这样的东西：

[代码片段暂时移除]

然而，我只是触及了他们.Net 的表面。

SDK

。我没有给它全面的性能分析，也没有给它代码审查。这不是我的工作。这是供应商的工作。

只是为了确保我

wasn

’t 为无关紧要的事情抱怨，我把代码给了一个负责我们一个部门的同事看。他以前是一个资深的 C 游戏开发者。我把代码给他看时，他摇了摇头，说这种懒惰是没有借口的。

由于这段代码每天被调用约 200 万次，我非常担忧。如果在公开的源代码中发现了这些异常，那么产品实际引擎下可能隐藏着什么？

总之，我给供应商和世界各地的程序员一些建议：

+   1) 持续优化和重构

+   2) 使用代码分析工具对你的代码进行分析。使用.NET CLR 分析器。使用 DevPartner Studio。使用 Visual Studio 2008 内置的分析器。

+   3) 不要将 C#当作弃儿。如果你要发布一个.NET SDK，请确保它和你的 Java 及 C++ SDK 一样优秀。而且，当你重构你的 Java SDK 时，也请重构 C# SDK。

+   4) 质量控制。在这种情况下，我们发现供应商没有对.NET SDK 做足够的尽职调查。必须进行代码覆盖和单元测试。

+   5) 如果你在一个超类中进行了一次增强，确保你也对其他所有超类进行了增强。

+   6) 代码审查。让更多人的眼睛来看代码！

就我而言，我刚刚让我们的一个初级开发人员重构了一些解析我们的 FIX 消息并将其转换为 C#对象的代码。他将 3 次对 string.Substring()的调用替换为一次对 string.Split()的调用。运行一些测试后，他说我们只取得了 2%的改进。对于每天被调用几次百万次的代码，我很乐意接受这 2%的改进，更不用说减少了进入堆的小东西。

我们需要开始进行代码覆盖，但现在，我们需要将一个系统推向交易员...而且我们有这样的奢侈，除了我们，没有人会查看我们的代码！

©2008 Marc Adler - 版权所有
