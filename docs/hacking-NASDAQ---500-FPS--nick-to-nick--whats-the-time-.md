<!--yml

类别：未分类

日期：2024 年 05 月 13 日 00:07:34

-->

# 黑客入侵纳斯达克 @ 500 FPS：NIC 之间，现在几点？

> 来源：[`hackingnasdaq.blogspot.com/2010/01/nick-to-nick-nicknacks.html#0001-01-01`](http://hackingnasdaq.blogspot.com/2010/01/nick-to-nick-nicknacks.html#0001-01-01)

之前测试的拓扑结构是 NIC -> switch -> NIC，我们假设交换机造成了不必要的延迟。结果证明是真的，但并不像预期的那样。

NIC <-> switch <-> NIC 的传输时间

NIC <-> NIC 的传输时间

如你所见，摆脱交换机可以节省约 7,000ns，还算不错，但总共 23,000ns 仍然有所花费。首先要做的事情是简单估算一下，然后乘以两倍。

GigE 的吞吐量为 1e9 比特/秒，因此每一帧的平均大小约为 160B（减去 PHY 结构），所以一侧编码大约需要 1,280ns。我们进行了 x4 次（编码->解码->编码->解码），所以我们大概需要 5,120ns 左右来编码这个东西，再慷慨地翻倍，结果约为 10,000ns 来解释 GigE PHY 结构和其他内容，但还是缺少 13,000ns！

顺便说一句，到目前为止我们使用的 82573L NIC 有点不对。看起来我假设一个机架上的两个 NIC 使用相同的控制器，但这是不正确的。实际上，我们一直假定的 82573L NIC 实际上是英特尔 82566DC-2 NIC。如果我们*真的*使用 82573L，情况就不那么美好了。

NIC <-> NIC 实际英特尔 82573

当与使用英特尔 82566DC 进行比较时，令人感兴趣。

NIC <-> NIC 英特尔 82566DC

其实，82573L 比 82566DC 大约早一年，2005 年对比 2006 年，但这本身不足以解释巨大的大约 15,000ns 的差异。再深入挖掘一点，两张卡的主机接口有显著差异，82573L 采用 PCIe，而 82566DC 采用英特尔专有的 LCI*/*GLC 总线-它直接线接到南桥。让我们假设 5,000ns 是改进的硬件设计，留下来每个方向大约 5,000ns，花在 PCIe 编码/解码/集线器/和大型缓冲区周围，这恰好是我们失踪的 13,000ns 数字的附近（记住只有 1 个 NIC 是在 PCIe 上）。

我们对时间去向有一些想法：

- GbE 编码/解码/传输需要 10,000ns

- PCIe 编码/解码/转发/传输需要 10,000ns

- 3,000ns

LCI/GLC 编码/解码/传输（还有剩下的）

我不知道这些猜测有多现实，继续深入需要昂贵的硬件工具，因此不可用。所以我们就把互连布线中的 23,000ns 和一个方向的平均硬件时间 23,000ns/4 = 5,740ns 左右放到这儿。
