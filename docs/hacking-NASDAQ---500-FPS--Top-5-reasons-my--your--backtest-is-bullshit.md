<!--yml

类别：未分类

日期：2024-05-13 00:01:43

-->

# 以 500 FPS 的速度黑客 NASDAQ：我（你）回测结果是胡扯的前 5 个原因

> 来源：[`hackingnasdaq.blogspot.com/2012/12/top-5-reasons-my-your-backtest-is.html#0001-01-01`](http://hackingnasdaq.blogspot.com/2012/12/top-5-reasons-my-your-backtest-is.html#0001-01-01)

构建/回测策略的很多时候，你可能得到一个看起来太好以至于不真实的结果。当这种结果出现时，测试你的崭新的百万 *咳咳* 美元 *咳咳* 策略最佳方式是

1) 调换方向/信号- 如果可能的话，例如不捕获买入/卖出价差..

2) 随机() 是你的朋友，用你的秘密酱料信号生成器替换随机() 看看会发生什么。

我更喜欢使用一个随机() 策略或者一个“总是交易”的策略，因为它们干扰性小。如果它生成了百万美元的回测利润... 你知道它完全胡扯。

所以以大卫·莱特曼的十佳风格..

## **我（你）回测结果是胡扯的前 5 个原因**

数字 5... 你的成本结构有误

量化交易的震惊和恐怖之一是意识到你在所有角度被每个人以各种方式搞得很惨。人们谈论交易时，都是关于（卖价-买价）== 你银行账户里的钱。遗憾的是，由于毛利润率非常低，还有很多费用和税收，银行账户里的钱并不总是那么美好...

一定要包括

1) 交易费用/回扣

2) 美国证券交易委员会费用/税收

2) 券商费用

3) 你（不）友好的资本利得税人

4) [可选] 汇率

今年被 4)搞得很惨 – 日元/美元真的很疼

数字 4.... 你建了一个时间机器，酷，我能买一个吗？

需要认真更改我的交易点子草稿/研究框架，以完全消除这个问题。目前基本上使用数据数组，其中每个索引都是时间/事件样本。问题是很容易做出类似 if (Price[t] > Price[t+1] ) 这样的比较，这样做就是在窥探未来，可能会严重偏离结果。更痛苦和微妙的变化是使用多个数据集/信号，它们并不是完全同步的，例如一个信号领先于其他信号。

唯一的办法是使这件事变得不可能，比如说策略无法访问数组/预先计算的数据，或者非常非常小心。我目前的处理方式是后者。当我开始时，会犯这个错误的次数比我想承认的要多，但这些天很少犯错 – 追逐这种随机() 策略盈利到底是什么鬼，浪费了太多时间

数字 3.... 事件序列 != 时间序列

大多数交易所会将多个市场数据事件打包到单个 UDP 数据包中，使得市场数据事件流看起来像是一个时间序列，但实际上并非如此。一个简单的被动策略示例是，如果 BBO 价格水平的订单/数量少于 X，则进行替换/深入订单簿。如果你将事件流等同于时间序列，那么回测将始终避免深度、*主动*交易。为什么？因为每当每个订单被某个大规模*主动*交易所搞砸时，每个被动订单被填充时，都会生成一个单独的市场数据更新。

现在。如果将每个市场数据更新都视为一个离散的事件，你的策略/回测可以看到每个更新，直到它达到最低的 X 水平并进行替换。也就是说，一个完美的零延迟系统。

出了什么问题？在实时交易中，所有订单同时被搞砸，包括你的！一组市场数据事件实际上是一个原子操作。

第二……在交易日开始时重置持仓

在进行多天回测时，很容易忘记策略在一天结束时仍然是开放的。例如，策略退出条件尚未触发，通常是处于亏损状态。最简单的例子是，每隔 1 分钟主动买入 SPY，然后在+X 个点处被动卖出，并且在新的交易日开始时没有持仓。结果是你有 100%的盈利交易！为什么？因为当市场对你不利时，该策略就会漂浮在那里，远离最佳买卖价。 （处于一个 10 英尺深的红色池中）等待被动出场。然后当市场收盘时，你的回测为下一个交易日重置策略，那笔亏损被简单地忽略了，消失了，从未存在过。如果有一个绿野仙踪的巫师，肯定会要求出现这样一个按钮。

每次交易后都要更新持仓/盈亏 - 不仅仅在退出时更新，并且不要在交易日之间重置。

第一……在出价处*主动*买入，然后在要价处*主动*卖出。

这太容易了……只需在每一个 tick 上的每一个工具，对世界上每一个交易所*主动*出价购买，并且*主动*要价出售，你自己就可以救赎希腊，西班牙，甚至可能是世界上一半的国家，没问题。

问题在于，在现实生活中，你会*主动*按照要价买入，也就是说，支付利差以立即成交。我在测试想法时经常搞砸这件事。通常是因为摆弄不同的交易进出方式，然后忘记还原代码，结果……每天盈利 100 万美元。

--------

到目前为止，你要么摇摇头表示我有多糟糕，要么悄悄点头表示你从未告诉任何人的错误，要么哈哈大笑说是的，我也碰到过，再也不会做了。

哦，羞耻…哈哈
