<!--yml

分类：未分类

日期：2024-05-12 18:53:51

-->

# 量化交易：条件组合优化：使用机器学习根据市场环境调整资本分配

> 来源：[`epchan.blogspot.com/2022/10/conditional-portfolio-optimization.html#0001-01-01`](http://epchan.blogspot.com/2022/10/conditional-portfolio-optimization.html#0001-01-01)

在这篇博客上，我们曾经写过一篇关于我们发明的基于机器学习的参数优化技术，称为[条件参数优化](https://predictnow.ai/blog/conditional-parameter-optimization-adapting-parameters-to-changing-market-regimes/)（CPO）。它在优化交易策略的操作参数方面似乎效果很好，但我们越来越多地发现，它最大的力量在于其优化组合分配的潜力。我们称这为条件组合优化（幸运的是，它也共享相同的缩写）。

让我们回顾一下条件参数优化是什么。传统上，优化任何业务过程（如交易策略）的参数是找出过去数据中哪些参数能带来最优结果的问题。例如，设置 1%的止损给出了一个交易策略在过去 10 年回测中的最佳夏普比率。或者以每分钟 1 米的速度运行传送带导致了制造过程中缺陷率最低。当然，根据许多不同因素，数值优化过程可能会变得相当复杂。例如，如果参数数量很大，或者与结果相关的目标函数是非线性的，或者参数上有许多限制。已经有了一些处理这些困难的标准方法。

在我们 PredictNow.ai，关注的是当目标函数不仅非线性，还取决于外部时间变化和随机条件时。在交易策略的情况下，最优止损可能取决于市场环境，这可能定义不明确。在制造过程中，最优传送带速率可能取决于数十个传感器读数。这样的目标函数意味着在特定的一组外部条件传统优化方法通常不能给出最优结果。此外，即使你指定了那一组确切的条件，结果也是不确定的。解决这个问题的最好方法莫过于机器学习！

通过使用机器学习，我们可以使用神经网络近似这个目标函数，通过使用历史数据训练其众多节点。（回想一下，神经网络能够[近似几乎任何函数](https://en.wikipedia.org/wiki/Universal_approximation_theorem)，但你也可以使用许多其他机器学习算法来代替神经网络完成这个任务）。这个神经网络的输入不仅包括我们最初打算优化的参数，还包括衡量外部条件的众多特征集合。例如，为了表示“市场体制”，我们可能包括市场波动性、不同市场部门的行为、宏观经济状况以及其他许多输入特征。为了帮助客户高效地运行他们的模型，Predictnow.ai 提供了[数百个这样的市场特征](https://predictnow.ai/blog/new-additions-to-the-predictnow-ai-factor-zoo-2/)。这个神经网络的输出将是您想要优化的结果。例如，最大化交易策略的未来 1 个月夏普比率是一个典型的结果。在这种情况下，您将把历史训练样本输入到神经网络中，包括交易参数、市场特征以及交易策略的未来 1 个月夏普比率作为“标签”（即目标变量）。一旦训练完成，这个神经网络就可以预测任何假设的交易参数和当前市场特征的未来 1 个月夏普比率。

使用这种方法，我们“只需要”尝试不同的假设参数集合，看看哪个给出最好的夏普比率，并采用这一组作为最优。我们之所以用引号标注“只需要”，是因为如果参数数量很大，尝试不同的参数组合可能需要非常长的时间来找到最优解。当应用为投资组合优化时，参数代表对投资组合不同组成部分的资本分配。这些组成部分可能是共同基金中的股票，或者是对冲基金中的交易策略。例如，对于持有标普 500 股票的投资组合，可能会有多达 500 个参数。在这种情况下，在训练过程中，我们预计要向神经网络输入这 500 个参数的所有可能组合，加上市场特征，找出由此产生的 5 天或 20 天回报率，或夏普比率，或我们想要最大化的任何绩效指标。所有可能的组合？如果我们表示分配给每只股票的资本权重为 w ∈ [0, 1]，假设我们不允许做空头，即使进行离散化，搜索空间也有 w500=[0, 1]500 组合，我们的计算机需要运行到宇宙尽头才能完成。克服这种维度诅咒是 Predictnow.ai 团队通过条件投资组合优化实现的主要突破之一。

为了衡量条件组合优化增加的价值，我们需要将其与替代组合优化方法进行比较。默认的方法是等权重：对所有组合成分应用相等的资本分配。另一种简单的方法是风险平价方法，其中每个成分的资本分配与其回报波动性的倒数成比例。它被称为风险平价，因为每个成分都应贡献相等的波动性，或风险，给整体组合的风险。这假设成分回报之间的相关系数为零，这当然是不现实的。然后有马科维茨方法，也称为均值-方差优化。这个众所周知的方法，使哈里·马科维茨获得了诺贝尔奖，基于成分回报的历史均值和协方差来最大化组合的夏普比率。具有最大历史夏普比率的优化组合也称为切点组合。我曾在之前的[博客文章](http://epchan.blogspot.com/2014/08/kelly-vs-markowitz-portfolio.html)中写过关于这个方法。它当然没有考虑到市场体制或任何市场特征。它也公然违反了熟悉的说法，“过去的表现不代表未来的结果”，并且众所周知会产生各种不幸的不稳定性（参见[这里](https://www.amazon.com/dp/0199959323/ref=as_sl_pc_tf_til?tag=quantitativet-20&linkCode=w00&linkId=&creativeASIN=0199959323)或[这里](https://amzn.to/3r7y2FA)）。尽管如此，它是最多的资产管理者使用的标准组合优化方法。最后，还有最小方差组合，它使用马科维茨的方法不是为了最大化夏普比率，而是为了最小化组合的方差（以及因此波动性）。即使这并没有最大化其过去的夏普比率，它常常导致实现比切点组合更好的前向夏普比率的组合！“过去的表现不代表未来的结果”的另一个案例。

让我们看看我们的条件组合优化方法与这些传统方法相比如何。对于 S&P 500 组合的无约束优化，允许做空并旨在最大化其 7 天前向夏普比率，

| 方法 | 夏普比率 |
| --- | --- |
| 马科维茨 | 0.31 |
| CPO | 0.96 |

（这些结果是从 2011 年 7 月至 2021 年 6 月的样本外期间，组合的股票范围是那些至少在过去一个月内存在于 SP 500 指数中的股票。我们在本表及以下表格中报告的夏普比率都是年化的）。CPO 将夏普比率相对于马科维茨方法提高了 3.1 倍。

然后我们测试在给定我们不能做空任何股票的约束条件下，我们的 CPO 对于 ETF（TSX: MESH）的表现，每个股票的权重 w 遵守 w ∈ [0.5%, 10%]，

| 期间 | 方法 | 夏普比率 | 年化复合增长率 |
| --- | --- | --- | --- |
| 2017-01 至 2021-07 | 等权重 | 1.53 | 43.1% |
| 风险平价 | 1.52 | 39.9% |
| 马科维茨 | 1.64 | 47.2% |
| 最小方差 | 1.56 | 38.3% |
| CPO | 1.62 | 43.6% |
| 2021-08 至 2022-07 期间， | 等权重 | -0.76 | -30.6% |
| 风险平价 | -0.64 | -22.2% |
| 马科维茨 | -0.94 | -30.8% |
| 最小方差 | -0.47 | -14.5% |
| CPO | -0.33 | -13.7% |

CPO 在牛市中表现与马科维茨方法相似，但在 2022 年的熊市中，它能够转为防御性位置，并且超越了马科维茨方法。在那次熊市中，它将夏普比率相对于马科维茨组合提高了 60%以上。这就是条件组合优化的全部理念——它适应预期的未来外部条件（市场体制），而不是盲目地优化过去发生的事情。

接下来，我们将 CPO 方法应用于一位私人投资者的科技组合，该组合包括 7 只美国股票和 2 只加拿大股票，主要集中在科技领域。约束条件是我们不能做空任何股票，每只股票的权重 w 遵守 w ∈ [0%, 25%]，

| 期间 | 方法 | 夏普比率 | 年化复合增长率 |
| --- | --- | --- | --- |
| 2017-01 至 2021-07 期间， | 等权重 | 1.36 | 31.1% |
| 风险平价 | 1.33 | 24.2% |
| 马科维茨 | 1.06 | 23.3% |
| 最小方差 | 1.10 | 19.3% |
| CPO | 1.63 | 27.1% |
| 2021-08 至 2022-07 期间， | 等权重 | 0.39 | 6.36% |
| 风险平价 | 0.49 | 7.51% |
| 马科维茨 | 0.40 | 6.37% |
| 最小方差 | 0.23 | 2.38% |
| CPO | 0.70 | 11.0% |

CPO 在所有市场条件下表现都优于其他两种方法。特别是，在熊市中，它将马科维茨组合的夏普比率提高了 75%。

我们还测试了 CPO 在不寻常资产上的表现——一个由 8 种加密货币组成的组合，同样允许空头头寸，并旨在最大化其 7 天的前向夏普比率，

| 方法 | 夏普比率 |
| --- | --- |
| 马科维茨 | 0.26 |
| CPO | 1.00 |

(这些结果是一个从 2020 年 1 月到 2021 年 6 月的样本外期间，组合的加密货币宇宙包括 BTCUSDT、ETHUSDT、XRPUSDT、ADAUSDT、EOSUSDT、LTCUSDT、ETCUSDT、XLMUSDT)。CPO 将夏普比率相对于马科维茨方法提高了 3.8 倍。

最后，为了表明 CPO 不仅仅适用于资产组合，我们将它应用于一家 proprietary trading firm WSG 实盘交易的 7 种外汇交易策略组合。这是一个由 7 种交易策略组成的组合，分配约束为 w ∈ [0%, 40%]，

| 方法 | 夏普比率 |
| --- | --- |
| 等权重 | 1.44 |
| 马科维茨 | 2.22 |
| CPO | 2.65 |

(这些结果是一个从 2020 年 1 月到 2022 年 7 月的样本外期间。CPO 将夏普比率相对于马科维茨方法提高了 19%)。

在所有 5 种情况下，CPO 能够在市场下跌时超越简单的等权重组合和马科维茨组合，而在牛市时则表现出相似的性能。

对于使用我们 CPO 技术的客户，我们可以向期望的最优组合中添加特定的限制条件，例如平均 ESG 评级、对各个行业的最大暴露度，或在组合再平衡过程中的最大周转率。我们唯一需要他们提供的输入是组合成分的历史回报（除非这些成分是公开交易的资产，在这种情况下，客户只需告诉我们它们的交易代码）。Predictnow.ai 将提供预先配置的市场特征，以捕捉市场体制信息。如果客户有专有的市场特征，这些特征可能有助于预测他们的组合回报，他们也可以将其与我们的特征合并。客户的特征可以保持匿名。我们将为希望尝试不同限制及其对最优组合影响的客户提供一个 API。

如果您想了解更多内容，请参加我们于 2022 年 10 月 22 日星期四中午 12:00（纽约时间）举办的条件组合优化网络研讨会。请在此[注册](https://www.predictnow.ai/webinar/)。

同时，如果您有任何问题，请通过邮箱 info@predictnow.ai 与我们联系。
