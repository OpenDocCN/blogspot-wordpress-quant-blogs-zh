<!--yml

类别：未分类

日期：2024 年 5 月 13 日 00:03:38

-->

# 以 500 FPS 黑客纳斯达克：黑匣子内部

> 来源：[`hackingnasdaq.blogspot.com/2012/04/under-hood-of-black-box.html#0001-01-01`](http://hackingnasdaq.blogspot.com/2012/04/under-hood-of-black-box.html#0001-01-01)

构建中频策略比 HF/UHF 策略更加复杂，至少目前是这样。使用 HF/UHF，你要寻找的是一个简单的模式，带有简单的数据转换，足够一致，你就可以建立一个可利用的策略。而使用中频策略，它仍是一个简单的模式，不同的是抽象级别和交易的 greeks 更加复杂 - 至少看起来是这样。例如，不再关注非常短期微观库存/信息/延迟套利机会，而是关注高度抽象化和转换后的数据集中的静态模式。

我的中频策略进展不顺利，需要很长时间，我设定了月底截止的严格期限……这个期限每天都在逼近。因此，几乎可以肯定的是要将机器从 cololocation 中拔出，重新调整，舔舐伤口，好好休息一下，然后带着修改后的方法前进……但是从 0 开始我无法完成这些。

所以不再抱怨我的（缺乏的）盈利，更多地关注技术方面。这是我的系统的逻辑块图。

相当简单吧？

首先是 NIC`s

NIC0 -> ssh /管理接口

NIC1 -> 订单输入

NIC2 -> 未使用

NIC3 -> 市场数据

下面是 HWT`s

传统智慧说你应该关闭超线程，因为它对核心的性能有重大影响，这可能是真的。超线程是通过在硬件中拥有独立的“上下文”来工作，例如在同一个执行管线中共享相同的执行管线。在概念上类似于一个分时操作系统，其中每个进程/线程在其时间切片开始时拥有所有用户态寄存器的副本，线程执行一段时间，寄存器被复制回内存，然后新的线程被切换进来。这允许多个程序共享单个 CPU，并最大化 CPU 的利用率。硬件线程以类似的方式工作，但在处理器微体系结构的 ISA（指令集架构）层上。

分时操作系统和超线程的理论都是，对于大部分时间的情况下，执行单元都是空闲的，因为程序正在等待 IO。因此，一些其他的程序可以利用硬件资源，同时等待阻塞 IO 的完成，你可以获得更高的执行占用率和更高的吞吐量，但代价是增加的延迟。

操作系统示例：

当一个线程被阻塞，等待键盘/磁盘/网络输入时，其他的线程就会运行。

HW 示例：

一次内存读取未命中 L1/L2/L3 缓存，必须从 DDR 中取出（100 个周期），其他程序在这些周期内运行。

自 2001 年以来一直在编写 8 核异步系统，所以最近为宽处理而设计是相当自然的 - 曾经经历过那个转变的痛苦。因此有足够的进程/线程，但核心不够，所以必须承担延迟成本并启用超线程。

每个 HWT 的简短描述。所有进程/线程都锁定到各自的 HWT 上。

HWT0

这是通用的，所有东西都在这上面运行。对于 linux 系统来说，该系统看起来像是一个 HWT 机器。bash sshd 等等。

HWT1：

未定义任何内容。具体取决于我对机器做什么来分配什么。例如实时策略、回测、备份/计算。

HWT2：

所有策略的 FIFO 调度（如非分时切片）运行。处理设置为执行一轮策略的一个周期，然后通过轮询（通过 linux 调度程序）切换到下一个策略等。可能会很危险，因为策略可能会互相影响，但核心策略逻辑通常非常简单和轻便。

HWT3：

对于 HF/UHF，暴力数值计算的数量并不太高，因此单个 HWT 就足够了。线程有一个工作队列，任何人都可以提交要进行计算的东西。

HWT4：

市场数据源处理程序。您可能会问为什么只有 1 个 HWT？答案是添加的队列越多，延迟越高。我的系统只有 1 个队列，那就是套接字的 Rx 缓冲区，它是庞大的。第二个答案是，我没有为纳斯达克的所有~6.5K 个符号保留账本，因此不需要额外的吞吐量。正如 2010 年提到的那样，关键在于极快的琐碎拒绝来过滤掉所有不需要的垃圾。

HWT5：

这是磁盘 io 核心，它唯一的目的是将共享内存块复制到 SSD。

HWT6：

网关+主动风险检查。这将内部订单请求（new/mod/can/exe）转换为本机协议版本，并在发送到市场之前执行基本风险检查/头寸管理/手误检查。网关或一些人称为 OMS，具有启用/禁用订单发送的外部程序挂接。风险检查很少，因为它处于关键的延迟路径上，因此更复杂的检查会在交易后被动进行。

HWT7：

网络工具/被动风险检查。此 HWT 的第一部分是捕获和记录所有方向的数据，类似 NSA 风格的第二层窃听 - 是的，我看见你在门口敲门 192.168.42.1。另一部分是伪实时地消化和分析捕获的数据。这里有软延迟限制，理想情况下，所有这些功能将在独立的机器上运行，但是...不想为此花费现金。

...因此探索继续挖掘大量数据，驾驶一辆 500HP 的高尔夫球车，在香港一些不靠谱的小巷上面试技术的极限...这就是我的风格: P
