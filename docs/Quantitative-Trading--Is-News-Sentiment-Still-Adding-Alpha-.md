<!--yml

类别：未分类

日期：2024 年 05 月 12 日 18:55:05

-->

# 定量交易：新闻情感是否仍在增加 Alpha？

> 来源：[`epchan.blogspot.com/2019/04/is-news-sentiment-still-adding-alpha.html#0001-01-01`](http://epchan.blogspot.com/2019/04/is-news-sentiment-still-adding-alpha.html#0001-01-01)

作者：Ernest Chan

[Roger Hunter](http://www.qtscm.com/principals/)

现在，几乎不可能进入一个量化交易会议而不被数据供应商的传单和关于新闻情感的小组讨论所轰炸。我们在 QTS 的团队过去曾经努力过，试图从这样的数据中提取价值，但效果并不好。但是对于测试预处理的替代数据的中心困境是：是否由于这些数据中缺乏 alpha，还是供应商的数据预处理有误？我们，像许多量化交易员一样，没有时间自己构建自然语言处理引擎，将原始新闻故事转化为情感和相关性得分（尽管 NLP 曾经是我们中的一个人的专长），我们依赖数据供应商为我们完成这项工作。我们无法从这样的供应商中提取太多 alpha，并不意味着新闻情感总体上是无用的。

因此，我们听到 42 亿美元以上的对冲基金 Two Sigma 赞助一件事非常兴奋。

[Kaggle 上的新闻情感竞赛](https://www.kaggle.com/c/two-sigma-financial-news)

，提供来自汤森路透的免费情感数据进行测试。该数据始于 2007 年，涵盖了约 2000 只美国股票（其中日交易金额约为 100 万美元或更多），并且由 Intrinio 提供了这些股票的价格和交易量。最后，我们从一个行业领先的新闻情感数据源中寻找 Alpha！

比赛的评估标准实际上是用户构建的股票持仓的市场中性投资组合的夏普比率，持有时间为 10 天。 （通过市场中性，我们指的是零贝塔。虽然这不是 Two Sigma 的说法，但可以证明他们的标准等价于我们的陈述。）

[统计学上](http://www.kaggle.com/marketneutral/eda-what-does-mktres-mean)

和数学上他们的标准等价于我们的陈述。）这恰好是使用新闻情感进行交易策略的“alpha”或超额收益的夏普比率。

设计一个简单的交易策略来测试具有预处理的新闻情感评分的 Alpha 似乎很简单，但是 Kaggle 和 Two Sigma 共同使得这项研究异常繁琐和耗时。以下是 Kagglers 的一些常见抱怨，我们经历了其中的所有痛苦：

1.  由于没有人被允许将珍贵的新闻数据下载到自己的计算机上进行分析，研究只能通过在 Kaggle 服务器上运行的 Jupyter Notebook 进行。任何尝试过 Jupyter Notebook 的人都知道，这是一个非常好的实时协作和演示平台，但是一个非常难以操作的调试平台

1.  不仅 Jupyter Notebook 不是进行有效研究和软件开发的次优工具，我们只被允许使用 4 个 CPU 和非常有限的内存进行研究。GPU 访问被阻止，所以运行你的深度学习模型祝你好运。即使简单的数据预处理也多次因内存问题杀死我们的内核，以至于我们完成时头发都快掉光了。

1.  Kaggle 如果在几个小时内让内核空闲，就会杀死内核。祝你训练机器学习模型一夜之间好运，并且早上 3 点起床及时保存结果。

1.  您不能将任何补充数据上传到内核。别想使用你最喜欢的市场指数作为输入，或者用你最喜欢的 ETP 对冲你的投资组合。

1.  没有“证券主数据库”来指定每个公司的唯一标识符并将新闻数据与价格数据链接起来。

最后一个问题需要一些解释。价格数据使用公司的两个标识符，assetCode 和 assetName，这两个都不能作为其唯一标识符。例如，一个 assetName 如 Alphabet 可以映射到多个 assetCodes 如 GOOG.O 和 GOOGL.O。我们需要分别跟踪 GOOG.O 和 GOOGL.O，因为它们有不同的价格历史。这带来了在如 CRSP 等工业级数据库中不存在的问题，并迫使我们设计自己的算法来创建唯一标识符。我们是通过查找每个 assetName 的多个 assetCode 历史是否在时间上重叠来实现的。如果如此，我们每个 assetCode 都当作不同的唯一标识符。如果不是，那么我们只是使用最后一个已知的 assetCode 作为唯一标识符。在后一种情况下，我们还检查了“合并”多个 assetCode 是否合理，通过检查一个的结束和另一个的开始之间的差距是否很小，以及价格是否合理。由于只有大约 150 个案例，这些都可以外部检查。另一方面，新闻数据只有 assetName 作为唯一标识符，因为假设不同类别的股票如 GOOG.O 和 GOOGL.O 受到 Alphabet 相同新闻的影响。所以每个新闻条目可能映射到多个价格历史。

价格数据也非常嘈杂，Kagglers 花了大量时间用外部来源的好数据替换坏数据。（如上所述，这不能算法化进行，因为数据既不能下载也不能上传到内核。花费时间的手动纠正坏数据的过程似乎是为了折磨参与者。）确定新闻数据中是否包含坏数据更困难，但至少，一些重要新闻情感特征的统计时间序列图没有显示出结构性断裂（与我们先前提到的另一个供应商的数据不同。）

为了避免过拟合，我们首先尝试了两个最明显的数值新闻特征：情感（Sentiment）和相关性（Relevance）。每条新闻项目的情感值从-1 到 1，相关性值从 0 到 1。将它们结合成一个特征的最简单、最合理的方式是将它们相乘。但由于每条股票每天可能有大量的新闻项目，而我们每天只做一次预测，我们需要一种方法将这个特征在一个或多个天内聚合。我们计算这个特征在过去 5 天内的简单移动平均（5 是这个模型的唯一参数，在 20070101 到 20141231 的训练数据上优化）。最后，预测模型也尽可能简单：如果移动平均值是正的，买入股票；如果是负的，则做空。所有交易信号的资本分配是均匀的。正如我们上面提到的，这场比赛的评价标准意味着我们必须在 t+1 天的市场开盘后进入这样的头寸，此时 t 天的新闻情感数据已经由午夜（UTC 时间）知晓。这个头寸必须持有 10 个交易日后在 t+11 天的市场开盘时退出，并且组合的净 beta 必须用适当数量的市值指数对冲。从 20150101 到 20161231 的验证集 alpha 约为 2.3%每年，令人鼓舞的夏普比率是 1。从 20170101 到 20180731 的样本外测试集 alpha 略低，为 1.8%每年，夏普比率为 0.75。你可能认为这只是一个小幅下降，直到你查看了它们各自的股票曲线：

数据科学中一个陈词滥调得到了证实：一图胜千言。（也许你听说过）

[安斯康姆四重奏](https://en.wikipedia.org/wiki/Anscombe%27s_quartet)

（疑问）我们很乐意投资一个在验证集中看起来那样的策略，但是绝不可能对测试集这样做。我们在验证集中做了什么样的过拟合，导致了测试集中如此多的“方差”（在偏差-方差意义上）？诚实的答案是：什么也没有。正如我们上面讨论的，策略仅基于训练集指定，唯一的参数（5）也是纯粹基于那些数据优化的。验证集在实质上是一个样本外的测试集，与“测试集”没有区别。在这个案例中区分验证集和测试集是为了期待机器学习超参数优化，但实际上这个简单的新闻策略并没有使用到。

我们稍后会更详细地讨论这种性能下降的问题。现在，让我们来探讨另一个问题：分类特征能否提高验证集的性能？我们从所有新闻项目中含量最丰富、最直观重要的两个分类特征开始：headlineTag（标题标签）和 audiences（受众）。

标题标签（headlineTag）特征是一个单独的标记（例如“BUZZ”），共有 163 个独特的标记。观众（audiences）特征是一组标记（例如{'O', 'OIL', 'Z'}），共有 191 个独特的标记。处理这些分类特征最自然的方式是使用“独热编码”：每个这些标记在特征矩阵中都会得到自己的列，如果新闻包含这样的标记，相应的列将得到“真”值（否则为“假”）。独热编码还允许我们在一些回望期内对这些特征进行汇总。为此，我们决定使用或运算符在最近的交易日（而不是数字特征的 5 天回望）对这些特征进行汇总。即只要最近一天的新闻包含一个标记，我们将该日特征设置为真。在尝试使用这个特征矩阵构建预测模型之前，我们比较了它们与使用 LightGBM 实现的提升随机森林（boosted random forest）中其他现有特征的特征重要性。

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOwGEUaA_kXl4KXT44Hbt7lFcyxs4fnl_BxkywglqTBeRK-scjQ4TeLGQoT-cv0UTYO7dvOgd5yruHJV6qQ251aL8-t6733V6-0i7VOdNybUrQm2ddunmCTbyMvvvvzFgseFPWSg/s1600/Features+importance+LGBM.png)

这些分类特征与价格特征（回报）相比，在最重要的 5 个特征中无处可寻。但更令人震惊的是，LightGBM 返回 assetCode 作为最重要的特征！那是在使用训练数据进行特征重要性排名时的一个常见谬误（问题在

[Larkin](https://www.kaggle.com/marketneutral/the-fallacy-of-encoding-assetcode)

.) 如果一个分类器知道 GOOG 在样本内具有很好的夏普比率，当然它会预测 GOOG 将具有正的残差回报，无论怎样！计算特征重要性的正确方法是应用

[平均减少准确性](https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089/ref=as_sl_pc_tf_til?tag=quantitativet-20&linkCode=w00&linkId=d7381a1bc4fd7adf25c210b2967e15be&creativeASIN=1119482089)

（MDA）使用验证数据或进行交叉验证（参见我们的

[核](http://www.kaggle.com/chanep/assetcode-with-mda-using-random-data)

演示了 assetCode 一旦我们这样做就不再是一个重要的特性。）另一步，我们可以手动排除这样在股票历史中保持不变的特征，从特征重要性排名中。一旦我们这样做，我们发现最重要的特征是

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjftipeXELT07Lof60YIEgoIOefOnmGVpUXrfapzShCqG0yBFFzqfwPVLporAbp-dFBPx1OEq9SnoYYhptDO1-vOKCiBg-e6i15SBQoyfZySWWi_NKSIalJBkIsX_Jvod02TE37QA/s1600/Correct+features+importance+LGBM.png)

与价格特征相比，这些分类新闻特征的重要性要小得多，我们发现将它们添加到上述简单的新闻策略中并不能提高性能。

那么让我们回到这个问题上，为什么我们的简单新闻策略在从验证集到测试集的性能会如此恶化。（我们应该指出，不仅是我们无法从新闻数据中提取很多价值。其他 Kagglers 发布的多数内核在生成 alpha 时也没有显示出加入新闻特征的好处。许多领先参赛者发布的内核中使用了复杂的价格特征和复杂的机器学习算法。）我们已经排除了过拟合，因为从验证集中没有提取到额外的信息。其他可能性是运气不佳、政权更迭或 alpha 衰减。比较两个股票曲线，运气不佳似乎是一个不太可能的解释。考虑到策略只使用新闻特征，而不使用宏观经济、价格或市场结构特征，政权更迭似乎也不太可能。alpha 衰减似乎是一个可能的罪魁祸首——这是我们指的是由于其他使用相同特征生成信号的交易者的竞争而导致的 alpha 衰减。最近发表的一篇学术论文（

[Beckers, 2018](https://jpm.iijournals.com/content/45/2/58)

）支持了这一猜想。基于对使用新闻情绪数据的大部分已发表策略的元研究，作者发现，这样的策略在 2003 年至 2007 年期间产生了 0.76 的信息比率，但仅在 2008-2017 期间产生了 0.25，下降了 66%！

这意味着我们应该放弃新闻情绪作为特征吗？不一定。我们的预测范围被限制在 10 天内。如果存在此类数据，当然应该测试其他范围。当我们在一次会议上概述我们的发现时，一位观众成员建议，如果我们小心选择应用新闻情绪的国家（印度？），或行业（与国防相关的股票？），或市值（零股？），它仍然可能是有用的。由于 Two Sigma 施加的限制，我们只研究了市值排名前 2000 的美国股票，但在您自己的新闻情绪研究中，您不必遵守这些限制。

----

**研讨会更新：**

我们推出了一门新的在线课程“生命周期交易策略开发与机器学习”。这是一门长达 12 小时、深入、专注于金融数据处理和应用机器学习生成交易策略的在线讲座。我们将带领您通过使用机器学习创建和改进交易策略的完整生命周期，包括自动执行，从我们自己的研究和实践中获得独特的见解和评论。我们将广泛使用 Python 包，如 Pandas、Scikit-learn、LightGBM，以及 QuantConnect 等执行平台。本课程将由 QTS Capital Management, LLC 的负责人 Ernest Chan 博士和 Roger Hunter 博士共同教授。详情请查看。

[www.epchan.com/workshops](http://www.epchan.com/workshops)

有关注册详情。
