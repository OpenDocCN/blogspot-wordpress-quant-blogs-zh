<!--yml

类别：未分类

日期：2024-05-12 19:55:22

-->

# Falkenblog：AMM LP Unprofitability: irrationality, volatility premium, or passive trading?

> 来源：[`falkenblog.blogspot.com/2024/02/amm-lp-unprofitability-irrationality.html#0001-01-01`](http://falkenblog.blogspot.com/2024/02/amm-lp-unprofitability-irrationality.html#0001-01-01)

自动做市商（AMMs）的一个令人困惑的方面是，总体而言，LP 亏钱，但似乎没有人在乎。Uniswap 是这里最突出的 AMM 开发者，目前价值 90 亿美元。Uniswap 的文档页面只间接涉及 LP 的盈利能力，指向了没有数据的理论论文 ([链接](https://pintail.medium.com/uniswap-a-good-deal-for-liquidity-providers-104c0b6816f2)) 或来自 2019 年的个人经验博客文章 ([链接](https://pintail.medium.com/uniswap-a-good-deal-for-liquidity-providers-104c0b6816f2))。

如果你搜索这个主题并寻找经验分析，通常会得到一种不切实际的分析。例如，[一篇论文](https://arxiv.org/abs/2205.08904)表明

我们对实际的 Uniswap V3 流动性提供者的风险和收益进行的支持性数据分析强调了在 Uniswap V3 中提供流动性是非常复杂的，并且绩效可能变化得非常大。

这可以说是关于任何一个人不理解的事情。最集中的主要经验研究是由 [Topaze Blue](https://arxiv.org/ftp/arxiv/papers/2111/2111.09192.pdf) 在 2021 年进行的，即使在那里，他们能说的最好的也只是一半的 LP 亏钱，这几乎毫无意义：按计数还是按资本？亏损是否比利润大或小？只是愚蠢的人吗？无论如何，很少有经验调查将数据分成十几个子样本，并在散点图中呈现数百个点，但没有一个表格列出简单的“平均 LP 盈利能力”。

我自 2022 年以来一直在发布关于 AMM LP 盈利性的文章 [since 2022](https://efalken.substack.com/p/uniswap-lps-are-losing-money)，趋势是一致的：主要货币对的 LP 都在亏钱。[1]

LP 的盈利性是一个重大问题。互联网和汽车等变革性技术经历了几十年的持续指数增长，而 AMM 的使用量在推出两年后达到了顶峰，但至今没有恢复。这与 AMM 的盈利能力有关，这不仅仅是一个费用问题，正如 Uniswap 的 30 个基点（bp，即 0.3%）池和 5 个基点池，以及 TraderJoe 的 22 个基点池的相似损失率所示。资本高效池的 LP 一直在稳定地亏钱。

有趣的是，Uniswap 的最初的 v2 池子，独特地只有一个不受限制的范围，自 2020 年 4 月启动以来一直对 LP 有利可图，但新的资本高效的受限范围方法立即使其相形见绌，因此它在今天的相关性有限。然而，这给出了一些线索，说明了普通受限范围池中驱动 LP 盈利能力的因素，因为它显然不是区块链的基础（例如，MEV）。

总结一下，LP pnl 可以分为三个部分。

**LP pnl = + 代币价格变动 + 手续费 - 凸度成本**

代币价格变动对基础池的影响远远超过了其他因素，因为这种风险与 LP 的头寸正交并且可对冲，我们可以消除这一因素来更清楚地看到 LP 的盈利能力。这给了我们

**LP pnl = 手续费 - 凸度成本**

手续费很容易看到，但凸度成本是微妙的，除非你特意去计算它们。例如，如果你在一个池子里存入 1 个 ETH 和 2000 美元，而 ETH 的价格上涨到 2400 美元，你取出 0.91 个 ETH 和 2191 美元，获利 382 美元，不含手续费。你赚了钱，但显然你因凸度成本损失了 18 美元（在 [此处](https://efalken.substack.com/p/video-on-how-to-calculate-amm-lp) 查看关于计算 pnl 的视频）。

### **原因 #1：非理性**

加密货币充满了明显的非理性，名人和推销者推动没有合法用途的硬币，使内部人能够赚取大量资金。然而，在具有开放进出的流动市场中，这应该是微不足道的。然而，存在一种微妙的选择偏见，类似于赢家诅咒，即拍卖获胜者倾向于过度支付，因为最乐观的出价者必然获胜。类似地，也许 LP 倾向于低估凸度成本或高估交易量。如果预期服从正态分布，而最乐观者成为 LP，他们可能会因为对主观估计的过度自信而损失资金。这在 Uniswap v2 中似乎同样有可能，因为我们看到了利润，所以它本身不能成为充分的解释。

Uniswap v3 中的资本效率提升了 v2 LP 仓位。假设一个 LP 考虑到一个池子，在凸度成本净回报后，产生了 2% 的年化收益率。与许多承诺 100%+ 回报的 YouTube 影响者不同，这样的回报并不荒谬。通过集中流动性，将范围限制在 20% +/- 的上下，可以将所需的资本减少 90%，如同 10 倍杠杆。这将 v2 池子上的 2% 回报转化为 21% 回报。下面，我们可以看到对基础 2% 年化收益率的限制范围的影响。每个 LP 位置都投入了相同的资本，但随着范围的缩小，回报被放大。

**各个范围的市场价值和流动性**

**当前价格 = 2000**

**v2 的年化收益率假设为 2%**

因此，如果一个人认为池子像 v2 池一样有利可图，考虑到平均范围为 +/- 10%，那将是一个有吸引力的回报。在这种框架下，一个轻微的高估会变得引人注目。这与无处不在的过度自信偏见完美契合，因为不仅过度乐观的 LP 会看到显著的回报，而且他们还会认为他们可以通过将资金应用于比平均范围更集中的区域来胜过他们的 LP 同行。例如，如果 Bob 投入了 $1k 在一个 10% 范围内，Alice 可以投入 $1k 在一个 5% 范围内，使 Bob 的利润翻倍，并自豪地宣称她是最擅长 LP 的人。

这个问题很微妙，因为在边际流动性或部分均衡分析中，LP 的盈利与流动性呈线性关系。在一般均衡中，更多的流动性不会改变交易量太多，如果他们每个人都提供 10 或 100 单位的流动性，Bob 和 Alice 将获得相同的收入分配。然而，他们的凸度成本将会增加十倍并且是确定的。Uniswap v3 对于这种方式的自信度特别敏感，这种情况不适用于 v2 方法，其中这种机制不存在。

### #2：反向维加溢价

在传统金融中，短凸度存在回报溢价，通常称为波动率溢价。可以在方差互换、跨式组合和隐含波动率期货（例如，空头 VXX ETF）中看到它。它存在于所有发达股票市场，并且具有类似的风险，会在危机时表现不佳，比如 2008 年的上一次大衰退或 2020 年 3 月的短暂崩溃。短波动率/伽马头寸会像股票市场一样产生溢价是有道理的，因为它具有相似的风险配置，替代了对这种风险因素的暴露。相比之下，加密货币的波动率溢价则相反。例如，这是野村研究为几个主要股票市场制作的总回报图表。

这里是 SPY，美国股票指数 ETF 的当前隐含波动率。随着市场预计如果价格下跌波动率将增加，低行权价格的波动率更高。

这里是 Deribit 上的比特币隐含波动率。在这里，市场预期价格上涨时波动率会上升。加密隐含波动率的笑曲与股票的笑曲方向相反。

直觉上讲，这是有道理的，因为当加密货币价格飙升时，波动率会上升。我使用了自 1926 年以来的美国股票市场每日数据以及 2016 年以来的 ETH 和 BTC 数据来记录这一点。然后，我使用了约 5 个数据点计算了每周的总回报和波动率。这表明，与股票不同，回报在最高波动率十分位数时最高，在最低波动率十分位数时最低。因此，在加密货币中，持有波动率头寸就像持有市场头寸一样，应该会产生风险溢价。

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-aukGL3DlA18wsnzMFSxrGB53S7jFhWHla1CFhJTyrFwwAZbklpn8u3Zg6Mhp3z_CzjUEYG9BJOqee5gka0j2suVgRAIFusOuGYWcay-bLT4odqibSAqZ8ArQqxOcu4szKabeIwvi5xqogk_1kYwTfinna75TS3biW7mmN_6-uvDtA2vQiBG9zw/s613/volcorr.png)

如果长期加密波动性头寸可以产生正收益，那么短波动性就产生负收益。在加密货币市场中，与股票不同之处在于，持有加密货币波动性就像持有基础资产。如果加密货币预期的收益是正的，那么持有加密货币波动性的收益也是正的。如果短期加密货币波动性产生了正收益，一个人可以作为 LP 对波动性进行沽空，然后做多加密货币，形成一个对冲组合，两个腿都能盈利，套利。我没有来自 Deribit 的隐含波动率数据，但了解过去几年的平均值将会很有趣。

对于波动性的预期正收益而言，一个 LP 的头寸就像一个标准的对冲，成本很高。至少，它降低了对于负凸度头寸正收益的市场压力，就像一个恒定产品自动做市商 LP。

### #3：LP 头寸作为挂单

我最近发现许多 LP 头寸是被动交易策略（ht [@ryskfinance](https://twitter.com/ryskfinance)）。例如，如果我将 1 ETH 发布在当前 ETH 价格的正上方，一旦价格越过我的区间，我就已经卖掉了 ETH，同时获得了交易费用而不是支付它。这并不是免费的午餐，因为从统计上看，价格将显著高于该区间，隐含着你本可以卖得更多，典型的逆向选择。这个策略的有效性取决于许多参数，所以我不会讨论它是否是一个好主意。我想知道它是否会带来实质性的变化。

如果许多 LP 有效地以这种方式交易，它们可能会由于头寸暗含的曲率而亏钱。但是，由于它们有不同的目标，这并不是问题。当我们移除这些参与者时，我们需要估计 LP 的盈利能力，因为他们可能会使整体盈利统计数据产生偏差。

为了估计它们的影响，我考虑了所有从 2023 年 1 月 1 日到 2024 年 2 月 14 日的 Uniswap v3 ETH-USDC 5bp 池中所有的挖矿和销毁情况。我只包括在这个时间范围内完成来回交易的 LP 头寸，其中包括添加和移除两个单独的交易。如果初始区间高于或低于当前价格，并且持有不到七天，存款和提款可以在单一交易中完成，我将一个 LP 头寸分类为被动交易。我还排除了那些代币变化为零的 LP 头寸，因为这些将永远不会触及 LP 风险或收入。

**LP 头寸**

**在 1/1/23 到 2/16/24 之间**

上表显示，在这 409 天中，这些被动交易 LP 仓位占总铸造量的 5%。这些 LP 的绝对 USDC 变化量不是 LP 仓位中交易的总量，而是净值。例如，如果价格在一次交易中跨越了一个范围，然后在下一个区块中移除，LP 的净 USDC 变化量将等于它们的毛 USDC 变化量。如果价格进入范围并在上下价格边界之间反弹，那么毛 USDC 交易量将远远大于净 USDC 交易量。被动交易 LP 仓位的平均持续时间仅为半天，中位数范围大小为 0.2%，因此它们不会产生除了推动价格穿越它们范围所需的代币之外的显著费用。

为了估算它们对总 LP 凸性成本的影响，我使用了初始价格和结束价格、LP 范围的下限和上限以及它们的流动性。例如，在下面的范围内，从 125 到一个上限价格 175，如果初始价格在 p0 处，约为 115，则范围高于当前价格。这些仓位将仅提供一种代币，并且范围将位于初始 AMM 价格的上方或下方。

我用于凸性成本的公式是

**凸性成本 = 流动性 * (sqrt(p0) – sqrt(p1))² / sqrt(p0)**

这里，p0 是穿越的范围中的第一个价格，而 p1 是与 LP 仓位相关的更极端的最终价格。这捕捉了 LP 仓位的负凸性成本。LP 仓位的利润在创立时进行了对冲，不包括费用（因此，总是亏损）。正如我在 [上周二的帖子](https://falkenblog.blogspot.com/2024/02/hedging-negative-convexity.html) 中解释的那样，静态对冲不会改变凸性成本的预期成本。但它消除了简单仓位 delta 的一阶效应，否则这些数据点的波动性将增加 100 倍。虽然更好的估计会每日更新对冲比率，但这对我来说需要十倍的工作量。我下面的方法假定静态对冲，产生了一个无偏估计，考虑到我的样本中有数千个 LP 仓位，这是足够高效的。

关于受限范围的棘手之处在于上述三种情况，即范围高于、低于或跨越当前价格的情况。这些需要不同的公式来估算仓位中的代币数量和 LP 在其生命周期内的凸性成本。初始状态和仓位移除时有三种情况，总共有九种组合。以下是这九种情况如何映射到上述方程中使用的价格。

**基于范围位置的 LP 仓位的价格点**

下面列出了总成本。我提供了三种不同的凸性成本计算，突出了这些方法的标准误差。所有方法都依赖于不同的假设，但它们对其大致数量的精确度给予了信心。

凸性成本

1/1/23 到 2/16/24

现金流：USDCin + ETHin * endPrice – 0.05%*abs(USDCtraded)

Sqrt()2: 流动性 * (sqrt(endPrice) – sqrt(initPrice))² / sqrt(initPrice)

方差：2 * 流动性 * sqrt(initPrice) * 方差 / 8

数据是从 1/1/23 到 2/16/24 每日计算并累加的。

尽管被动交易 LP 仅占总凸性成本的约 5%，但这是重要的，因为 LP 损失是由大约比收入高出 9%的成本所驱动的。在这段时间里，这个池子里的平均每日净 LP 利润约为-13k 美元，其中包括约 141k 美元的手续费收入和 154k 美元的凸性成本（请参见此处的解释）。如果我们从凸性成本中减去 3.6 百万美元/409，每日损失就会降至每日 4k 美元。

任何与大型数据集打过交道的人都知道，许多问题只有通过经验才能发现。我只研究了这个效应几天；我的 LP 凸性成本数字还是初步的。

### **结论**

AMM LP 的不盈利性是一个问题，但也许不像我想象的那么令人困惑。主要是作为被动限价订单投入的 LP 头寸在很大程度上会对标准 LP 的盈利能力产生偏见，因为这些 LP 并不提供流动性来赚钱，而是试图执行条件交易（挂单限价订单）。这种效应似乎是大部分 LP 亏损的原因。

尽管缩小范围的竞赛产生了负面外部性，许多 LP 并不欣赏，但随着时间的推移，亏钱往往会使最狂妄的人醒悟。反常的长期波动率溢价减少了 LP 们要求做空波动率的大幅正收益的趋势，因为做空波动率/γ/凸性的溢价不会是一个均衡，鉴于在这个资产类别中，波动率和收益是正相关的。我认为这两者都是相关的，但很难知道有多少。

我希望更多的人能够解决这个问题，因为正如最初所指出的，很少有论文估计平均 LP 的盈利能力。通常，一个收益农场建立在像恒定产品 AMM 这样的东西上，而农民 dapp 只是将手续费收入（和空投！）相加，生成高度误导性的 APYs。尽管最近的加密牛市掩盖了许多糟糕的商业模式，但从长远来看，建立在零或负长期回报的 LP 代币上的 dapp *是不会成功的*。我意识到这个领域的大多数人不关心长远，尽管他们永远不会公开承认。尽管如此，很多人确实关心，他们应该优先考虑去中心化和可持续的机制。一个可持续的 AMM 必须为其 LP 产生利润。

1 有数不清的长尾 AMM，而在迷因币上无需许可地创建交易对的能力似乎是一个可持续的模型，因为新币源源不断地涌入。此外，由于这些币没有在链下列出，LP 可能能够通过与内部人员联系来避免逆向选择。这增加了这些币中经常出现的特定个别欺诈的风险，因此提取一般统计数据是一个二级考虑。

2 与赢家诅咒的类比并不完美，因为每个想成为 LP 的人都按照比例受到相同的对待，而在拍卖中，只有最高出价者付款并获得物品。尽管如此，它突显了对买家的选择偏见。
