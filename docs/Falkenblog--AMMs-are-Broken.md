<!--yml

category: 未分类

date: 2024-05-12 19:56:50

-->

# Falkenblog: AMM is Broken

> 来源：[`falkenblog.blogspot.com/2022/11/amms-are-broken.html#0001-01-01`](http://falkenblog.blogspot.com/2022/11/amms-are-broken.html#0001-01-01)

流动性挖矿协议主要依赖于提供 Uniswap 等自动做市商（AMM）上流动性所产生的费用。通常，像 ETH/USDC 这样的交易对会被隔离成一个“池”，而流动性提供者（LP）只会暴露于特定的这个交易对池中。额外的收益来自于质押，也就是将资金锁定在 dapp 或区块链中以获取代币。这是所有人从[Gemini](https://www.gemini.com/cryptopedia/what-is-yield-farming-crypto-defi-liquidity-mining#section-staking-crypto-vs-yield-farming)到普通的加密货币影响者都在推广的荒谬年化收益率（APY）的主要来源。

常见的错觉性加密货币文章标题

任何有些灰色头发的人都会立刻认为这是不可能的，就像有人告诉你他们如何创造了永动机一样。如果有人真的找到了一种 100%+的回报策略，他们是不会告诉任何人的，因为那样会使得这个极少的机会变得平淡无奇。例如，在 21 世纪初，一对[退休密执安夫妇](https://www.cbsnews.com/news/jerry-and-marge-selbee-how-a-retired-couple-won-millions-using-a-lottery-loophole-60-minutes-2019-06-09/)发现了如何从一个新的、理念不成熟的彩票中获得 80%的回报。他在近十年内赚了大约 800 万美元，并邀请了亲近的朋友和家人。他们没有在 Facebook 上发布寻找投资者。

除了指出[最好的情况](https://www.stakingrewards.com/staking/)是赚取 10%的情况之外，我将不会讨论质押的回报。就像所有的好骗局一样，这个策略有其合理性（在以太坊上的质押提供了 4%的年化收益，而且它提供了一个真正的服务）。然而，大多数质押计划都没有其他目的，只不过是经典庞氏骗局。推动者让早期投资者在他们的庞氏代币中进行质押。他们过度的在线游戏，通常明确使用词语“拉动”，激励更多的初学者购买庞氏代币进行质押，从而骗子通过铸造新的具有增值的代币支付给初始投资者。这是如此愚蠢的策略，我对深入讨论没有兴趣。

对于 LP 策略的研究，我将会关注 Uniswap，因为它是最不那么坑人的，而且在 AMM 池中锁定的价值最多。我还将专注于 ETH/USDC 交易对，以使应用变得不那么抽象（很难跟踪 tokenA 和 tokenB）。LP 为交易者提供了一个选择：你可以用 1100 美元购买 ETH，或者以 1100 美元出售 ETH。选择也是有价值的，所以交易者会通过 0.05%或 0.3%的交易价值作为手续费来支付这个价值。LP 的利润等于总收入减去支出。

AMMs 的主要问题在于 LP 们要么完全无知，要么不了解他们正在编写的选择的价值。 注意对“临时损失”的暗示好像它并不真实。 要了解这种思维中的缺陷，请考虑在做多股票时编写（出售）认购期权的策略。 这种策略在出售期权时为编写人增加收益。 如果股票价格上涨，这个 Covered Call 头寸会赚钱，只是比不编写认购期权少； 如果股票价格保持不变，编写人由于认购期权溢价而赚取正数； 如果股票价格下跌，编写人损失的比不出售无价值认购期权时少。 一个油嘴滑舌的推销员可以将这种投资销售为无成本，因为如构建的那样，在任何情况下，Covered Call 编写者都不会亏钱([这个网站](https://app.ribbon.finance/)由 Ribbon finance 大胆地将其加密期权溢价发布为 APY)。

这种会计错误的关键在于评估投资组合的组成部分。 套利定价理论和常识告诉我们，投资组合的各个部分加起来等于整个投资组合的价值。 如果这不是真的，人们就可以购买一个投资组合，出售其组成部分，或反之亦然，并获利。 在 Covered Call 的情况下，您可以分别评估股票和认购期权头寸，并注意到，除了错误定价外，认购期权的价值等于其预期价值。 LP 头寸也是如此：它通过临时损失的预期价值产生费用。 考虑到 LP 通常不知道这种选择，并且 LP 的推广者不试图估算这笔费用，很容易理解为什么 LP 们大量低估了他们所写的选择的价值。

对这种成本的忽视无处不在。 例如，这里有一个顶级的收益农业机会列表，他们推广 Uniswap 产生一个不错的 40% APY。

他们怎么得到 20-40%的？ 通过将生成的费用年化除以池中的总投资价值。 如果您以这种方式查看突出的 Uniswap ETH/USDC 池，它们将产生这种数量级的 APY。 这通常是故意的无知。

当计算他们编写的期权的成本时，Uniswap LPs 通常会亏损很多钱。 这是一种不可避免的成本[我在这里写过关于此的文章](https://efalken.substack.com/p/how-and-why-to-measure-liquidity)。 如果您不了解，您不应该提供流动性池，因为您正在受到利用； 如果您了解，您不应该向 AMM 池提供流动性，因为您知道您正在亏损。

### 套利交易 LP 的收入不足

无论费用如何，套利交易都无法解决 AMM 问题。对于大多数活跃市场，Uniswap 池在紧密跟踪币安、Gemini 和 FTX 等中心化交易所价格方面相当有效。在过去的几年中，中心化交易所的价格始终相差不到 0.1%，因此我们可以将其中一个视为“真实”价格的反映。考虑下面的 PDF，展示了 Uniswap 池和 Gemini 价格之间差异的分布，使用了过去几个月的下采样分钟数据。

如果 AMMs 的价格与主要交易所上看到的“真实”价格紧密关联，那么下载中心化价格数据以查看对新 AMM 意味着什么是诱人的。

对于恒定函数做市商（CFMMs），AMM 数学意味着池子的流动性与价格波动之间存在以下关系。要注意的棘手之处在于，价格平方根的变化直接关系到交易的美元。

为了估算 LP 的收入，我们将使用一个简单的固定百分比费率进行乘法（例如，0.05%，0.3%）[我们将忽略费用适用于两种代币的事实，只关注美元收入。作为近似，这是足够的]。

鉴于这个公式，我们似乎可以通过查看来自币安或 Gemini 的价格变化来估算 LP 的收入。请注意，流动性是一个比例术语，因此我们可以查看池的总流动性，或将其应用于潜在投资，效果相同。边际 LP 和初始 LP 之间没有区别。在任何一种情况下，我们都乘以费用来获得 LP 收入。

如果我们应用 Gemini 的价格数据按分钟计算，使用这种方法，这种方法会大大高估 AMM 池的套利交易量。如果 AMM 池的当前价格与币安价格相差 0.5%，而费用为 1.0%，那么对于想要获利的套利者来说，这是不吸引人的。没有利润最大化的套利者会支付 1.0%来赚取 0.5%。我们在上面的 Gemini-Uniswap 价格差异图中看到了这一点，其中 0.3%费率池的分布比 0.05%费率池更宽。

海岸线越粗糙越短

费用直接影响总的 sqrt(p)移动。考虑上面显示的无限海岸线的数学奇点。如果我们假设海岸线是分形的，那么无论在哪个维度，海岸线看起来都是一样的。用无限精度来说，我们应该说加利福尼亚的海岸线和旧金山市的一样长。尽管这是一个受到现实世界中的普朗克长度限制的荒谬极限，但这突显了一个重要观点：平方根价格变化的总和是我们正在观察的任何波动路径的精度的函数。下面是本月特定某天的分钟下采样的股价图表。这里是 Gemini，Uniswap 的 ETH/USDC 0.3%费率池，以及它们的 0.05%费率池，分钟下采样。

这些线基本上是重合在一起的。然而，仔细观察，我们可以看到更大的费用会减少所有这些价格变化的总和。下面是一个 2 小时窗口的图片；我们可以清楚地看到 0.3%池显示出更多的价格静止。

虽然这不是很明显，但是 0.05%池的波动性也比 Gemini 价格小。虽然这一天看起来相当不寻常，但它代表了过去 12 个月的数据。下面的图表显示，0.05%费用池的价格变化约占平方根价格变化的 75%，而对于 0.3%池，则仅占 Gemini 价格变化的 25%。如果你创建一个模拟，在该模拟中仅在价格相对于初始价格上涨或下跌 0.05%或 0.3%时改变价格，你会看到类似的模式。无论如何都无法回避这一点。

目前，当我们应用标准期权成本时，这两个池中的 Uniswap LP 都会亏损。为了弄清楚这一点，我不是看每个 LP 是否没有对冲就赚了钱，而是假设他们像良好的资本管理者一样完美地对冲了他们的账本。这涉及将伽马（是明确的）和当天的价格波动率相乘。由于伽马是流动性和价格的函数，并且这两个池指的是相同的资产，它们有相同的价格。所以让我们来看看这两个池中的 pnl/流动性。[我在这里更详细地解释了这一点](https://efalken.substack.com/p/uniswap-lps-are-losing-money)。

**Uniswap 池数据**

在这里我们看到当 LP 头寸以流动性单位标准化时，0.05%池损失了大约两倍于 0.3%池。当前，0.3%池是两害相权取其轻的胜者，是最丑陋的猪比赛的胜利者。

然而，0.3%池的实际收入只有 Gemini 分钟下采样价格暗示的收入的 20%。如果你预期通过 Gemini 分钟数据进行套利交易的收入，那么你的预期会高出 5 倍。这是可以解释的，因为套利者需要池价格与 Gemini 价格相差 0.3%才能实现盈利；套利者会忽略在这一范围内的所有波动。

相比之下，0.05%池产生的收入略高于其与 Gemini 分钟价格数据匹配的收入。如果我们考虑到 Gemini 定价数据会因为 0.05%的费用而夸大套利价格变化，这意味着出现了流动性交易者，而这些交易者在 Uniswap 0.3%池中并不存在。休闲交易者更喜欢更具流动性和更便宜的 ETH/USDC 池。事实上，如果情况不同，那就太荒谬了。

虽然当前 0.3%池可能比 0.05%池更不那么令人愿意，但至少 0.05%池还有机会。对于仅为套利者提供流动性的 LP，净利润最多为零。当你考虑到套利者是另一方，并且他们有发起行动的选择时，这一点是显而易见的。他们的净 pnl 不仅包括 AMM 上的费用，还包括在中心化交易所进行对冲或支付燃气的交易成本。

好消息是，在 0.05%的资金池中出现了一些流动性交易者的迹象。坏消息是很少有人关注重要的问题。在这个领域的许多人没有意识到：1）自动做市商池已经崩溃，2）解决方案包括创建一种让 LPs 赚钱而不去到伪去中心化、允许审查/没收、低延迟的区块链（例如 Solana，无论 dydx 计划什么）的方法。

### 所需的解决方案

标准的中央限价订单簿有三种类型的交易者：不知情的、知情的和市场做市商。知情的交易者投资于数据、模型和硬件，以识别临时的定价错误。不知情的人因为理性和非理性的原因而无知：他们想要购买一辆车（流动性交易者），或者是妄想和交易无关的信息（噪声交易者）。由于知情和不知情的交易者不会同时出现，市场做市商出现以通过发布待成交的限价订单提供持续的流动性，进行买卖。

在平衡状态下，所有群体产生的收益等于它们的成本。知情交易者的成本被从陈旧的市场做市商限价订单中逆向选择的收入平衡。不知情者通过越过价差向市场做市商支付费用，从方便、快速的交易中受益。市场做市商发布订单，知道他们将与两种类型的交易者进行交易，设置限价订单，使不知情者的收入平衡他们输给知情者的收入。鉴于信息和技术的变化，平衡解决方案是不同的，并且在过去的 40 年里迅速发生了变化。

在历史上，市场做市商通过国家强加的垄断来解决这个问题。例如，几十年来，只能在纽约证券交易所交易某些股票，而专家会处理订单。尽管竞争在 20 世纪 70 年代出现，但直到 2000 年，大多数专家在一年中只有少数几天会亏钱进行“交易”。这仍然是一个主要的解决方案，因为 2008 年金融危机使美国监管机构获得了关闭场外市场的新权力，使用了确保我们经济体系安全的标准理由。这帮助芝加哥商品交易所（CBOT）和芝加哥商品交易所（CME）等场所加强了对期货和衍生品的控制。

随着互联网的发展，像 Archapalego 和 Island 这样的电子市场做市商改变了股票交易游戏。就像优步一样，它们在美国监管机构弄清楚如何打击它们之前变得太大了，并永远改变了资产交易。然而，这些新的电子市场做市商必须创造一些方式来产生优势，即进入的障碍。

他们主要通过发展套期保值和原始计算机硬件方面的规模经济以及一些 Alpha 来进行竞争，以给自己带来先进的优势。关键在于比下一个人快五毫秒，因为如果你看到一个“真正的”价格变化即将发生，你想要撤销你的限价单，让别人被碾压；如果你知道价格要上涨，你想在新的更高水平的队列顶部发布你的出价。鉴于限价订单簿的价格-时间属性，第 n 快的价值会迅速下降。

延迟游戏的核心在于避免逆向选择。市场做市商不会是那些引起价格波动的人；那是一组不同的技能和关注点。他们只需要更快地感知到这样的价格波动。高频交易商被指责很糟糕，但自 2000 年以来，权益交易成本大幅降低。看到左派渴望过去的好日子，那时垄断者会在微软这样的最受欢迎的股票上发布 1/4 的买卖价差，这有些奇怪；如今，高流动性的股票往往只有一分钱的价差。竞争是混乱的，胜者并不是由一个星座室审查的。你平均的好脾气的向权贵嗑起了无效，促进了停滞，更糟糕的是，鼓励人们撒谎（他们想要他们的特权，但总是把它呈现为缓解系统风险）。

高频市场做市商的另一个活跃焦点是识别来自知情交易者的流动性交易者。像 RobinHood 或 ETrade 这样的零售流动性是众所周知的不知情的。有许多机制来识别这种流动性，它们通常通过补充服务进行追求，或者卖给出价最高者（通过竞争来节省）。

AMM 是一项伟大的创新，但尚未解决生成可持续的自动化交易所的问题。它的时间已经不多了，因为 SushiSwap 代币的成功以及 Uniswap 的空投造成的初始兴奋掩盖了 LP 的整体表现不佳。最近，dydx 和 perp.fi 主要通过用户操纵其奖励系统产生了大量交易量。

几乎所有的 AMM 交易量都是一种幻觉，套利者从太愚蠢以至于不理解他们所写期权成本的 LP 那里赚钱。这些 LP 看到了费用，但忽视了“暂时性损失”的量化。在 2021 年这样的大牛市中，这些损失可以忽略不计。

DeFi 需要的是能够让 LPs 互相区分的解决方案。如果所有供应商都具有完全相同的成本和质量，就像很多人理想化的那样，那将不是乌托邦；而是不可持续的。这样的产品或服务的利润将被驱向零，并且市场将崩溃：供应商需要在可持续的市场中获利，买家需要获取消费者剩余价值。LPs 需要一种机制来建立进入壁垒，同时仍然遵守中本聪的原则：无需许可的访问、抗审查、不可变性和透明度。
