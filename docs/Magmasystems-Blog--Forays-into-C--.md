<!--yml

类别：未分类

日期：2024-05-18 04:58:02

-->

# Magmasystems 博客：深入 C++

> 来源：[`magmasystems.blogspot.com/2008/10/forays-into-c.html#0001-01-01`](http://magmasystems.blogspot.com/2008/10/forays-into-c.html#0001-01-01)

我们有一个基于 C#/.NET 的路透社市场数据适配器，我们自己写的（好吧，实际上是写的我）。这是一个进程外的 Coral8 适配器，它从 RMDS 读取实时滴答声，将它们转换为 Coral8 元组，并将它们喂给我们的 Coral8 引擎。适配器中有两个缓存，由于市场数据是最后可靠的，我们可以从其中一个缓存中以特定间隔发布最后可靠的滴答声。

当我们将市场数据适配器连接到我们的 Coral8 引擎时，我们开始看到挂起消息队列立即出现拥堵。我们向 Coral8 发送大约 3000 滴答声每秒。此外，我们的 Coral8 引擎正在处理我们的订单流程，峰值时可能达到另一 3000 条消息每秒。

我的第一个想法是 Coral8 反序列化市场数据元组的时间太长，所以我想要将我们的市场数据适配器从进程外适配器转换为进程内适配器。不幸的是，进程内适配器必须作为普通的，基于 Win32 的 C/C++ DLL 编写。

我是在 C++中长大的。然而，自从 2001 年深入.NET 以来，我再也没有碰过 C++。我很害怕。我很害怕。然而，我知道我的团队需要一些编写 Coral8 进程内适配器的经验，而且由于我的团队由非常强大的.NET 和 Java 人员组成，我决定挺身而出，为团队做贡献。

哦，天哪！我简直不敢相信我忘记了多少！'*'和'->'这样的奇怪符号从我指尖流出。编译错误无处不在。没有

Resharper

帮助我进行。链接器错误到奇怪

混淆

我发誓我从未写过的函数开始出现在错误窗口中。

也许我需要在这里使用一点

外部"C"

也许在那里？也许到处都是！

我的.NET 线程类在哪里？System.Timer 又在哪里？我如何处理事件？为了在内部获得回调工作，你必须经历一种新的痛苦。

模板

C++类。我花了几个小时才让简单的回调工作。

最后，经过两天的努力，我将市场数据适配器成功移植到 Coral8。首先，让我们尝试从平面数据文件中读取滴答声，而不是从路透社那里。哇，它起作用了。我看到滴答声出现在

在

Coral8 流查看器。现在，让我们试试路透社。经过一些调整和一些在

析构函数

终于，时钟开始进来了。

然后，我收到我们 Coral8 开发者的电子邮件，告诉我市场数据馈送之所以在 Coral8 中缓慢，是因为他写的那些神秘 Coral8 查询之一堵塞了系统！所以，我的

进程内

适配器不再需要。市场数据现在正快速通过我们的 Coral8 引擎。

尽管如此，从.NET 世界长达 7 年的休眠期中回归到我的 C++根源，这段经历真是令人着迷。绝不再来！

©2008 Marc Adler - 版权所有。

在这里表达的所有观点均为个人观点，与我的雇主无关。
